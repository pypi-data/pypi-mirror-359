<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>{{ title }}</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '{{ theme.primary | default("#73060F") }}',
            accent: '{{ theme.accent | default("#D9B166") }}',
            bg: '{{ theme.bg | default("#FAFAFA") }}',
            text: '{{ theme.text | default("#0D0D0D") }}',
          }
        }
      }
    };
  </script>

  <style>
    {{ theme_css }}
  </style>
</head>
<body class="bg-[color:var(--bg)] text-[color:var(--text)] font-sans p-8">

  <!-- Topo com título e logo -->
  <div class="flex justify-between items-center mb-8">
    <h1 class="{{ title_style }}">{{ title }}</h1>
    {% if logo_b64 %}
    <img src="data:image/png;base64,{{ logo_b64 }}" class="h-14">
    {% endif %}
  </div>

  <!-- Conteúdo injetado -->
  <div class="flex flex-col gap-6">
    {{ components | safe }}
  </div>

  <!-- Espera por renderização de gráficos -->
  <script>
    window.chartsDone = false;

    window.addEventListener("load", () => {
      const checkCharts = () => {
        const canvases = document.querySelectorAll("canvas");
        return Array.from(canvases).every(c => c.offsetHeight > 0);
      };

      const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

      const waitForCharts = async () => {
        for (let i = 0; i < 20; i++) {
          if (checkCharts()) {
            window.chartsDone = true;
            break;
          }
          await wait(100);
        }
      };

      waitForCharts();
    });
  </script>

</body>
</html>
