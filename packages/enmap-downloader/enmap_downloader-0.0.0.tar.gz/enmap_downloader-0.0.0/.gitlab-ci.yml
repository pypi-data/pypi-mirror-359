# SPDX-FileCopyrightText: 2025 GFZ Helmholtz Centre for Geosciences
# SPDX-FileCopyrightText: 2025 Felix Dombrowski
# SPDX-License-Identifier: EUPL-1.2

before_script:
  - git lfs pull

stages:
  - deploy

deploy_pypi:
  stage: deploy
  script:
    - source activate ci_env
    - pip install -U twine build
    - python -m build --sdist
    - twine check dist/*
    - twine upload dist/*  # requires creds as environment variables

send_to_zenodo:
  stage: deploy
  script:
      - source activate ci_env
      # - if [[ ! $CI_COMMIT_TAG =~ ^v?[0-9]+\.[0-9]+ ]]; then exit 0; fi
      - pip install -U gitlab2zenodo
      - git archive --format zip --output enmapdownloader-${CI_COMMIT_TAG}.zip ${CI_COMMIT_TAG}
      - g2z-send -t $DEPLOY2ZENODO_ACCESS_TOKEN -i $ZENODO_RECORD -m .zenodo.json enmapdownloader-${CI_COMMIT_TAG}.zip -p
