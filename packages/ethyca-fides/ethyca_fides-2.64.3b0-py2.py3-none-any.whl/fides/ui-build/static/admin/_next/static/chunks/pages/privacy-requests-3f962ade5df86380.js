(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2369],{1565:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/privacy-requests",function(){return s(8712)}])},30952:function(e,t,s){"use strict";s.d(t,{f:function(){return o}});var l=s(24246),a=s(66726),i=s.n(a),r=s(27378),n=s(26917);let o=e=>{let{value:t,onChange:s,placeholder:a,...o}=e,[d,u]=(0,r.useState)(t),c=i()(s,500),p=(0,r.useCallback)(e=>{u(e),c(e)},[]);return(0,l.jsx)(n.Z,{value:d,onChange:p,onClear:()=>{u(""),s("")},placeholder:a,...o})}},35287:function(e,t,s){"use strict";var l=s(24246),a=s(38355),i=s(88038),r=s.n(i);s(27378),t.Z=e=>{let{children:t,title:s,mainProps:i}=e;return(0,l.jsxs)(a.kCb,{"data-testid":s,direction:"column",height:"calc(100vh - 48px)",width:"calc(100vw - 240px)",children:[(0,l.jsxs)(r(),{children:[(0,l.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,l.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,l.jsx)(a.kCb,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...i,children:t})]})}},87361:function(e,t,s){"use strict";var l=s(24246),a=s(38355);t.Z=e=>{let{title:t,text:s,onClose:i}=e;return(0,l.jsxs)(a.Ugi,{backgroundColor:"gray.50",border:"1px solid",borderRadius:"md",justifyContent:"space-between",py:4,pr:6,pl:3,"data-testid":"empty-state",gap:2,position:"relative",children:[i&&(0,l.jsx)(a.Two,{boxSize:5,position:"absolute",right:3,top:3,zIndex:1,cursor:"pointer",p:1,onClick:i}),(0,l.jsx)(a.iid,{alignSelf:"start",color:"minos",mt:.5,flexGrow:0}),(0,l.jsxs)(a.kCb,{direction:"column",gap:2,flexGrow:1,children:[(0,l.jsx)(a.X6q,{fontSize:"md",children:t}),(0,l.jsx)(a.xvT,{fontSize:"sm",color:"gray.600",lineHeight:"5",children:s})]})]})}},96718:function(e,t,s){"use strict";s.d(t,{z:function(){return i}});var l=s(24246),a=s(38355);let i=e=>{let{...t}=e,s="multiple"===t.mode;return(0,l.jsx)(a.WPr,{defaultActiveFirstOption:!1,maxTagCount:"responsive",allowClear:!0,dropdownStyle:s?void 0:{width:"auto",minWidth:"200px"},className:"w-auto","data-testid":"filter-select",...t})}},97181:function(e,t,s){"use strict";s.d(t,{d:function(){return d}});var l=s(24246),a=s(38355),i=s(34090),r=s(27378),n=s(46238),o=s(40324);let d=e=>{let{name:t,label:s,labelProps:d,tooltip:u,isRequired:c,layout:p="inline",helperText:m,...h}=e,[x,v,{setValue:y}]=(0,i.U$)(t),j=!!(v.touched&&v.error),[g,b]=(0,r.useState)("");x.value||"tags"!==h.mode&&"multiple"!==h.mode||(x.value=[]),"tags"===h.mode&&"string"==typeof x.value&&(x.value=[x.value]);let _="tags"===h.mode?(e,t)=>e?e.value!==g||x.value.includes(g)?h.optionRender?h.optionRender(e,t):e.label:'Create "'.concat(g,'"'):void 0:h.optionRender||void 0,f=e=>{b(e),h.onSearch&&h.onSearch(e)},q=(e,t)=>{y(e),h.onChange&&h.onChange(e,t)};return"inline"===p?(0,l.jsx)(a.NIc,{isInvalid:j,isRequired:c,children:(0,l.jsxs)(a.rjZ,{templateColumns:s?"1fr 3fr":"1fr",children:[s?(0,l.jsx)(o.__,{htmlFor:h.id||t,...d,children:s}):null,(0,l.jsxs)(a.jqI,{align:"center",children:[(0,l.jsxs)(a.jqI,{vertical:!0,flex:1,className:"mr-2",children:[(0,l.jsx)(a.WPr,{...x,id:h.id||t,"data-testid":"controlled-select-".concat(x.name),...h,optionRender:_,onSearch:"tags"===h.mode?f:void 0,onChange:q,value:x.value||void 0,status:j?"error":void 0}),m&&(0,l.jsx)(a.Q6r,{children:m}),(0,l.jsx)(o.Bc,{isInvalid:j,message:v.error,fieldName:x.name})]}),(0,l.jsx)(n.b,{label:u,className:j?"mt-2 self-start":void 0})]})]})}):(0,l.jsx)(a.NIc,{isInvalid:j,isRequired:c,children:(0,l.jsxs)(a.gCW,{alignItems:"start",children:[(0,l.jsxs)(a.jqI,{align:"center",children:[s?(0,l.jsx)(o.__,{htmlFor:h.id||t,fontSize:"xs",my:0,mr:1,...d,children:s}):null,(0,l.jsx)(n.b,{label:u})]}),(0,l.jsx)(a.WPr,{...x,id:h.id||t,"data-testid":"controlled-select-".concat(x.name),...h,optionRender:_,onSearch:"tags"===h.mode?f:void 0,onChange:q,value:x.value||void 0,status:j?"error":void 0}),m&&(0,l.jsx)(a.Q6r,{style:{marginTop:0},children:m}),(0,l.jsx)(o.Bc,{isInvalid:j,message:v.error,fieldName:x.name})]})})}},71784:function(e,t,s){"use strict";s.d(t,{DE:function(){return o},I3:function(){return a},kN:function(){return r},qX:function(){return n},rE:function(){return i}});var l=s(46420);let a=[...new Map([[l.q2.APPROVED,"Approved"],[l.q2.AWAITING_EMAIL_SEND,"Awaiting email send"],[l.q2.CANCELED,"Canceled"],[l.q2.COMPLETE,"Completed"],[l.q2.DENIED,"Denied"],[l.q2.ERROR,"Error"],[l.q2.IN_PROCESSING,"In progress"],[l.q2.PENDING,"New"],[l.q2.PAUSED,"Paused"],[l.q2.IDENTITY_UNVERIFIED,"Unverified"],[l.q2.REQUIRES_INPUT,"Requires input"]])].map(e=>{let[t,s]=e;return{label:s,value:t}}),i=new Map([[l.Us.ACCESS,"Access"],[l.Us.ERASURE,"Erasure"],[l.Us.CONSENT,"Consent"],[l.Us.UPDATE,"Update"]]),r=[...i].map(e=>{let[t,s]=e;return{label:s,value:t}}),n={mailgun:"mailgun",twilio_email:"twilio_email",twilio_text:"twilio_text"},o={local:"local",s3:"s3",gcs:"gcs"}},8712:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return e_}});var l,a,i=s(24246),r=s(35287),n=s(38355),o=s(65218),d=s.n(o),u=s(27378),c=s(25980),p=s(19904),m=s(86677),h=s(59969),x=s(30952),v=s(18225),y=s(77830),j=s(42904),g=s(16394),b=s(71784),_=s(46420),f=s(52493);let q=e=>{let{task:t}=e,s=(0,m.useRouter)(),[l,{isLoading:a}]=(0,f.HP)();return"new"!==t.status?null:(0,i.jsxs)(n.vyj,{size:"small",children:[(0,i.jsx)(n.wpx,{type:"default",onClick:()=>{l({task_id:t.task_id,text_value:"string"===t.input_type?"":void 0,checkbox_value:"checkbox"!==t.input_type&&void 0})},size:"small",loading:a,children:"Complete"}),(0,i.jsx)(n.S0p,{menu:{items:[{key:"skip",label:"Skip task",onClick:()=>{}},{key:"go-to-request",label:"Go to request",onClick:()=>{s.push({pathname:y.ld,query:{id:t.privacy_request.id}})}}]},trigger:["click"],placement:"bottomRight",overlayStyle:{minWidth:120},children:(0,i.jsx)(n.wpx,{size:"small",icon:(0,i.jsx)(n.PJP.r43,{}),"aria-label":"More actions"})})]})},C={new:{color:"info",label:"New"},completed:{color:"success",label:"Completed"},skipped:{color:"marble",label:"Skipped"}},S=[{text:"New",value:"new"},{text:"Completed",value:"completed"},{text:"Skipped",value:"skipped"}],E=[{text:"Access",value:"access"},{text:"Erasure",value:"erasure"}],R=(e,t,s)=>[{title:"Task name",dataIndex:"name",key:"name",width:300,render:e=>(0,i.jsx)(n.AntTypography.Text,{ellipsis:{tooltip:e},children:e})},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>(0,i.jsx)(n.j8w,{color:C[e].color,"data-testid":"manual-task-status-tag",children:C[e].label}),filters:S,filterMultiple:!1},{title:"System",dataIndex:["system","name"],key:"system_name",width:210,filters:e,filterMultiple:!1},{title:"Type",dataIndex:["privacy_request","request_type"],key:"request_type",width:150,render:e=>{let t="access"===e?_.Us.ACCESS:_.Us.ERASURE,s=b.rE.get(t)||e;return(0,i.jsx)(n.AntTypography.Text,{children:s})},filters:E,filterMultiple:!1},{title:"Assigned to",dataIndex:"assigned_users",key:"assigned_users",width:380,render:e=>{let t=e.map(e=>({label:(0,g.gJ)(e),value:e.id})),l=e.map(e=>e.id);return(0,i.jsx)(n.d3V,{value:l,options:t,readonly:!0,onTagClick:e=>s(String(e))})},filters:t,filterMultiple:!1},{title:"Days left",dataIndex:["privacy_request","days_left"],key:"days_left",width:140,render:e=>(0,i.jsx)(h.Z,{daysLeft:e,includeText:!1,status:_.q2.PENDING})},{title:"Subject identity",dataIndex:["privacy_request","subject_identity"],key:"subject_identity",width:200,render:e=>{var t,s;if(!e)return(0,i.jsx)(n.AntTypography.Text,{children:"-"});let l=(null===(t=e.email)||void 0===t?void 0:t.value)||(null===(s=e.phone_number)||void 0===s?void 0:s.value)||"";return(0,i.jsx)(n.AntTypography.Text,{ellipsis:{tooltip:l},children:l})}},{title:"Actions",key:"actions",width:120,render:(e,t)=>(0,i.jsx)(q,{task:t})}],w=()=>{let e=(0,m.useRouter)(),[t,s]=(0,u.useState)(""),[l,a]=(0,u.useState)(1),[r,o]=(0,u.useState)(25),[d,c]=(0,u.useState)({}),{data:p,isLoading:h,isFetching:b}=(0,f.Ym)({page:l,size:r,search:t,status:d.status,systemName:d.systemName,requestType:d.requestType,assignedUserId:d.assignedUsers}),{items:_,total:q,filterOptions:C}=(0,u.useMemo)(()=>p||{items:[],total:0,pages:0,filterOptions:{assigned_users:[],systems:[]}},[p]),S=(0,u.useMemo)(()=>{var e;return(null==C?void 0:null===(e=C.systems)||void 0===e?void 0:e.map(e=>({text:e.name,value:e.name})))||[]},[null==C?void 0:C.systems]),E=(0,u.useMemo)(()=>{var e;return(null==C?void 0:null===(e=C.assigned_users)||void 0===e?void 0:e.map(e=>({text:(0,g.gJ)(e),value:e.id})))||[]},[null==C?void 0:C.assigned_users]),w=(0,u.useMemo)(()=>R(S,E,t=>{e.push({pathname:y.fw,query:{id:t}})}),[S,E,e]);return h?(0,i.jsx)(v.Z,{}):(0,i.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,i.jsx)(x.f,{placeholder:"Search by name or description...",value:t,onChange:e=>{s(e)},className:"max-w-sm"}),(0,i.jsx)(n.V5H,{columns:w,dataSource:_,rowKey:"task_id",pagination:{current:l,pageSize:r,total:q||0,showSizeChanger:!0,pageSizeOptions:j.W3,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),onChange:(e,t)=>{a(e),t!==r&&(o(t),a(1))}},onChange:(e,t)=>{let s={};t.status&&([s.status]=t.status),t.system_name&&([s.systemName]=t.system_name),t.request_type&&([s.requestType]=t.request_type),t.assigned_users&&([s.assignedUsers]=t.assigned_users),c(s),a(1)},locale:{emptyText:t?"No tasks match your search":(0,i.jsx)("div",{"data-testid":"empty-state",children:"No manual tasks available."})},loading:h||b})]})};var k=s(59003),I=s(92222),T=s(16125),A=s(91317),P=s(14048),N=s(85422),U=s(90867);let D={approved:{colorScheme:"success",label:"Approved"},complete:{label:"Completed",colorScheme:"success"},awaiting_email_send:{label:"Awaiting Email Send",colorScheme:"marble"},denied:{label:"Denied",colorScheme:"warning"},canceled:{label:"Canceled",colorScheme:"marble"},error:{label:"Error",colorScheme:"error"},in_processing:{label:"In Progress",colorScheme:"caution"},paused:{label:"Paused",colorScheme:"marble"},pending:{label:"New",colorScheme:"info"},identity_unverified:{label:"Unverified",colorScheme:"marble"},requires_input:{colorScheme:"alert",label:"Requires Input"}},z=e=>{let{value:t}=e;return(0,i.jsx)(N.A4,{color:D[t].colorScheme,value:D[t].label,"data-testid":"request-status-badge"})},O=e=>{let t,{daysLeft:s,timeframe:l=45,status:a,includeText:r=!1}=e;if(null==s||a===_.q2.COMPLETE||a===_.q2.CANCELED||a===_.q2.DENIED||a===_.q2.IDENTITY_UNVERIFIED)return null;let n=100*s/l;return n<25?t="error":n>=75?t="success":n>=25&&(t="warning"),(0,i.jsx)(N.A4,{value:r?"".concat(s," days left"):s.toString(),color:t})},M=e=>Array.from(new Set(e.filter(e=>Object.values(_.Us).includes(e.action_type)).map(e=>e.action_type))),Z=e=>{let{value:t}=e,s=M(t).map(e=>b.rE.get(e));return(0,i.jsx)(N.WP,{value:s,cellState:{isExpanded:!0}})};var F=s(58452),Y=s(57526),V=s(66548),W=s(45489);let L=e=>{let{subjectRequest:t,...s}=e,l=(0,n.qY0)(),a=(0,n.qY0)(),r=(0,n.qY0)(),{handleApproveRequest:o,handleDenyRequest:d,handleDeleteRequest:u,isLoading:c}=(0,W.Z)({subjectRequest:t});return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.Ugi,{...s,children:["pending"!==t.status?null:(0,i.jsx)(n.wpx,{title:"Approve","aria-label":"Approve",icon:(0,i.jsx)(n.PJP.MCw,{}),onClick:l.onOpen,loading:c,disabled:c,"data-testid":"privacy-request-approve-btn",size:"small"}),"pending"!==t.status?null:(0,i.jsx)(n.wpx,{title:"Deny","aria-label":"Deny",icon:(0,i.jsx)(n.PJP.x8P,{}),onClick:a.onOpen,loading:c,disabled:c,"data-testid":"privacy-request-deny-btn",size:"small"}),(0,i.jsx)(p.ZP,{scopes:[_.Sh.PRIVACY_REQUEST_DELETE],children:(0,i.jsx)(n.wpx,{title:"Delete","aria-label":"Delete",icon:(0,i.jsx)(n.PJP.ZNm,{size:14}),onClick:r.onOpen,loading:c,disabled:c,"data-testid":"privacy-request-delete-btn",size:"small"})})]}),(0,i.jsx)(n.h_i,{children:(0,i.jsx)(Y.Z,{isOpen:l.isOpen,isLoading:c,onClose:l.onClose,onApproveRequest:o,subjectRequest:t})}),(0,i.jsx)(n.h_i,{children:(0,i.jsx)(V.Z,{isOpen:a.isOpen,onClose:a.onClose,onDenyRequest:d})}),(0,i.jsx)(F.Z,{isOpen:r.isOpen,onClose:r.onClose,onConfirm:u,message:(0,i.jsx)(n.xvT,{children:"You are about to permanently delete the privacy request. Are you sure you would like to continue?"})})]})};(l=a||(a={})).STATUS="status",l.DAYS_LEFT="due_date",l.SOURCE="source",l.REQUEST_TYPE="request_type",l.SUBJECT_IDENTITY="subject_identity",l.TIME_RECEIVED="created_at",l.CREATED_BY="created_by",l.REVIEWER="reviewer",l.ID="id",l.ACTIONS="actions";let Q=(0,I.Cl)(),B=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return[Q.accessor(e=>e.status,{id:"status",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(z,{value:t()})},header:e=>(0,i.jsx)(N.Rr,{value:"Status",...e})}),Q.accessor(e=>e.days_left,{id:"due_date",cell:e=>{let{row:t,getValue:s}=e;return(0,i.jsx)(O,{daysLeft:s(),timeframe:t.original.policy.execution_timeframe,status:t.original.status})},header:e=>(0,i.jsx)(N.Rr,{value:"Days left",...e})}),...e?[Q.accessor(e=>e.source,{id:"source",cell:e=>e.getValue()?(0,i.jsx)(N.A4,{value:e.getValue()}):(0,i.jsx)(N.G3,{value:void 0}),header:e=>(0,i.jsx)(N.Rr,{value:"Source",...e}),enableSorting:!1})]:[],Q.accessor(e=>e.policy.rules,{id:"request_type",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(Z,{value:t()})},header:e=>(0,i.jsx)(N.Rr,{value:"Request type",...e}),enableSorting:!1}),Q.accessor(e=>{var t,s;return(null===(t=e.identity)||void 0===t?void 0:t.email.value)||(null===(s=e.identity)||void 0===s?void 0:s.phone_number.value)||""},{id:"subject_identity",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(N.G3,{value:t()})},header:e=>(0,i.jsx)(N.Rr,{value:"Subject identity",...e}),enableSorting:!1}),Q.accessor(e=>e.created_at,{id:"created_at",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(N.G3,{value:(0,g.p6)(t())})},header:e=>(0,i.jsx)(N.Rr,{value:"Time received",...e})}),Q.accessor(e=>{var t;return(null===(t=e.reviewer)||void 0===t?void 0:t.username)||""},{id:"reviewer",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(N.G3,{value:t()})},header:e=>(0,i.jsx)(N.Rr,{value:"Reviewed by",...e}),enableSorting:!1}),Q.accessor(e=>e.id,{id:"id",cell:e=>{let{getValue:t}=e;return(0,i.jsx)(N.G3,{value:t()})},header:e=>(0,i.jsx)(N.Rr,{value:"Request ID",...e}),enableSorting:!1}),Q.display({id:"actions",cell:e=>{let{row:t}=e;return(0,i.jsx)(L,{subjectRequest:t.original})},header:e=>(0,i.jsx)(N.Rr,{value:"Actions",...e}),meta:{disableRowClick:!0}})]},G=e=>{let t=(0,T.v9)(U.dp),s=(0,T.I0)();return{handleStatusChange:t=>{s((0,U.CI)(t)),e()},handleActionTypeChange:t=>{s((0,U.aM)(t)),e()},handleFromChange:t=>{s((0,U.su)(null==t?void 0:t.target.value)),e()},handleToChange:t=>{s((0,U.Ue)(null==t?void 0:t.target.value)),e()},handleClearAllFilters:()=>{s((0,U.Mk)()),e()},...t}};var K=s(96718);let X=e=>{let{onClose:t,onFilterChange:s,...l}=e,{handleStatusChange:a,handleActionTypeChange:r,handleFromChange:o,handleToChange:d,handleClearAllFilters:u,from:c,to:p,status:m,action_type:h}=G(s);return(0,i.jsxs)(n.u_l,{onClose:t,size:"xl",...l,children:[(0,i.jsx)(n.ZAr,{}),(0,i.jsxs)(n.hzk,{children:[(0,i.jsx)(n.xBx,{borderBottomWidth:1,borderBottomColor:"gray.200",children:"All Filters"}),(0,i.jsx)(n.olH,{}),(0,i.jsx)(n.fef,{py:4,sx:{"& label":{mb:0}},children:(0,i.jsxs)(n.Kqy,{gap:4,children:[(0,i.jsxs)(n.Kqy,{children:[(0,i.jsx)(n.lXp,{size:"md",id:"request-date-range-label",children:"Date range"}),(0,i.jsxs)(n.Ugi,{gap:3,children:[(0,i.jsxs)(n.BZy,{size:"sm",flex:1,children:[(0,i.jsx)(n.UiE,{as:"label",htmlFor:"from-date",borderRadius:"md",children:"From"}),(0,i.jsx)(n.IIB,{type:"date",name:"From",value:c,max:p||void 0,onChange:o,borderRadius:"md",id:"from-date","aria-describedby":"request-date-range-label"})]}),(0,i.jsxs)(n.BZy,{size:"sm",flex:1,children:[(0,i.jsx)(n.UiE,{as:"label",htmlFor:"to-date",borderRadius:"md",children:"To"}),(0,i.jsx)(n.IIB,{type:"date",borderRadius:"md",name:"To",value:p,min:c||void 0,onChange:d,id:"to-date","aria-describedby":"request-date-range-label"})]})]})]}),(0,i.jsxs)(n.Kqy,{children:[(0,i.jsx)(n.lXp,{size:"md",htmlFor:"request-status",children:"Status"}),(0,i.jsx)(K.z,{id:"request-status",mode:"multiple",options:b.I3,value:m,onChange:a,"data-testid":"request-status-filter"})]}),(0,i.jsxs)(n.Kqy,{children:[(0,i.jsx)(n.lXp,{size:"md",htmlFor:"request-action-type",children:"Request Type"}),(0,i.jsx)(K.z,{id:"request-action-type",mode:"multiple",options:b.kN,value:h,onChange:r,"data-testid":"request-action-type-filter"})]})]})}),(0,i.jsxs)(n.mzw,{justifyContent:"space-between",children:[(0,i.jsx)(n.wpx,{type:"text",onClick:u,children:"Clear all"}),(0,i.jsx)(n.wpx,{type:"primary",onClick:t,children:"Done"})]})]})]})},J=e=>{let{...t}=e,{plus:s}=(0,c.hz)(),[l,a]=(0,u.useState)(""),r=(0,T.v9)(U.dp),o=(0,T.v9)(A.rK),d=(0,n.pmc)(),p=(0,m.useRouter)(),h=(0,T.I0)(),{PAGE_SIZES:x,pageSize:v,setPageSize:y,onPreviousPageClick:j,isPreviousPageDisabled:g,onNextPageClick:b,isNextPageDisabled:_,startRange:f,endRange:q,pageIndex:C,setTotalPages:S,resetPageIndexToDefault:E}=(0,N.oi)(),{isOpen:R,onOpen:w,onClose:D}=(0,n.qY0)(),{data:z,isLoading:O,isFetching:M}=(0,U.QA)({...r,page:C,size:v}),{items:Z,total:F}=(0,u.useMemo)(()=>{let e=z||{items:[],total:0,pages:0};return S(e.pages),e},[z,S]),Y=(0,u.useCallback)(e=>{h((0,U.mU)(e)),a(e),E()},[h,E,a]),V=async()=>{let e;try{await (0,U.py)({...r,token:o})}catch(t){e=t instanceof Error?t.message:"Unknown error occurred"}e&&d({description:"".concat(e),duration:5e3,status:"error"})},W=e=>{p.push("/privacy-requests/".concat(e))},L=(0,k.b7)({getCoreRowModel:(0,I.sC)(),data:Z,columns:(0,u.useMemo)(()=>B(s),[s]),getRowId:e=>"".concat(e.status,"-").concat(e.id),manualPagination:!0,columnResizeMode:"onChange"});return(0,i.jsxs)(n.xuv,{...t,children:[(0,i.jsxs)(N.Q$,{children:[(0,i.jsx)(N.HO,{globalFilter:l,setGlobalFilter:Y,placeholder:"Search by request ID or identity value"}),(0,i.jsxs)(n.Ugi,{alignItems:"center",spacing:2,children:[(0,i.jsx)(n.wpx,{"data-testid":"filter-btn",onClick:w,children:"Filter"}),(0,i.jsx)(n.wpx,{"aria-label":"Export report","data-testid":"export-btn",icon:(0,i.jsx)(P.nM,{ml:"1.5px"}),onClick:V})]}),(0,i.jsx)(n.h_i,{children:(0,i.jsx)(X,{isOpen:R,onClose:D,onFilterChange:E})})]}),O?(0,i.jsx)(n.xuv,{p:2,borderWidth:1,children:(0,i.jsx)(N.I4,{rowHeight:26,numRows:10})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.ZK,{tableInstance:L,onRowClick:e=>W(e.id),onSort:e=>{if(!e){h((0,U.p2)()),E();return}let{id:t,desc:s}=e;h((0,U.PU)(t)),h((0,U.iX)(s?"desc":"asc")),E()}}),(0,i.jsx)(N.s8,{totalRows:F||0,pageSizes:x,setPageSize:y,onPreviousPageClick:j,isPreviousPageDisabled:g||M,onNextPageClick:b,isNextPageDisabled:_||M,startRange:f,endRange:q})]})]})};var H=s(812),$=s(87361),ee=s(46628),et=s(34090),es=s(55484),el=s(40324);let ea=(e,t)=>null==t?void 0:t.find(t=>t.policy_key===e),ei=e=>{var t,s;if(!e)return es.Ry().shape({policy_key:es.Z_().required().label("Request type")});let l=e.custom_privacy_request_fields?Object.entries(e.custom_privacy_request_fields).map(e=>{let[t,s]=e;return{[t]:es.Ry().shape({value:s.required&&!s.hidden?es.Z_().required().label(s.label):es.Z_().nullable()})}}).reduce((e,t)=>({...e,...t}),{}):{};return es.Ry().shape({policy_key:es.Z_().required().label("Request type"),identity:es.Ry().shape({email:(null===(t=e.identity_inputs)||void 0===t?void 0:t.email)==="required"?es.Z_().email().required().label("Email address"):es.Z_().nullable(),phone_number:(null===(s=e.identity_inputs)||void 0===s?void 0:s.phone)==="required"?es.Z_().matches(/^\+?[1-9]\d{1,14}$/,"Phone number must be formatted correctly (e.g. 15555555555)").required().label("Phone number"):es.Z_().matches(/^\+?[1-9]\d{1,14}$/,"Phone number must be formatted correctly (e.g. 15555555555)").nullable()}),custom_privacy_request_fields:es.Ry().shape(l)})};var er=s(97181);let en={is_verified:!1,policy_key:"",identity:{}},eo=e=>{let{identityInputs:t}=e;return t?(0,i.jsxs)(i.Fragment,{children:[t.email?(0,i.jsx)(el.j0,{name:"identity.email",label:"User email address",isRequired:"required"===t.email,variant:"stacked"}):null,t.phone?(0,i.jsx)(el.j0,{name:"identity.phone_number",label:"User phone number",isRequired:"required"===t.phone,variant:"stacked"}):null]}):null},ed=e=>{let{customFieldInputs:t}=e;if(!t)return null;let s=Object.entries(t);return(0,i.jsx)(i.Fragment,{children:s.map(e=>{let[t,s]=e;return(0,i.jsx)(el.j0,{name:"custom_privacy_request_fields.".concat(t,".value"),label:s.label,isRequired:!!s.required,variant:"stacked"},t)})})};var eu=e=>{let{onSubmit:t,onCancel:s}=e,{data:l}=(0,U.xv)();return(0,i.jsx)(et.J9,{initialValues:en,onSubmit:t,validationSchema:()=>(0,es.Vo)(e=>ei(ea(e.policy_key,null==l?void 0:l.actions))),children:e=>{var t;let{values:a,dirty:r,isValid:o,isSubmitting:d,setFieldValue:u}=e,c=ea(a.policy_key,null==l?void 0:l.actions);return(0,i.jsx)(et.l0,{children:(0,i.jsxs)(n.Kqy,{spacing:6,mb:2,children:[(0,i.jsx)(er.d,{name:"policy_key",label:"Request type",options:null!==(t=null==l?void 0:l.actions.map(e=>({label:e.title,value:e.policy_key})))&&void 0!==t?t:[],onChange:e=>{let t=ea(e,null==l?void 0:l.actions);if(!(null==t?void 0:t.custom_privacy_request_fields)){u("custom_privacy_request_fields",void 0);return}u("custom_privacy_request_fields",Object.entries(t.custom_privacy_request_fields).map(e=>{let[t,s]=e;return{[t]:{label:s.label,value:s.default_value}}}).reduce((e,t)=>({...e,...t}),{}))},layout:"stacked",isRequired:!0}),(0,i.jsx)(eo,{identityInputs:null==c?void 0:c.identity_inputs}),(0,i.jsx)(ed,{customFieldInputs:null==c?void 0:c.custom_privacy_request_fields}),(0,i.jsx)(el.Xl,{name:"is_verified",label:"I confirm that I have verified this user information"}),(0,i.jsxs)("div",{className:"flex gap-4 self-end",children:[(0,i.jsx)(n.wpx,{onClick:s,children:"Cancel"}),(0,i.jsx)(n.wpx,{htmlType:"submit",type:"primary",disabled:!a.is_verified||!r||!o,loading:d,"data-testid":"submit-btn",children:"Create"})]})]})})}})},ec=s(31883);let ep=e=>{let{isOpen:t,onClose:s}=e,[l]=(0,U.M6)(),a=(0,n.pmc)(),r=async e=>{let{is_verified:t,...i}=e,r=i.custom_privacy_request_fields?Object.entries(i.custom_privacy_request_fields).map(e=>{let[t,s]=e;return s.value?{[t]:s}:{}}).reduce((e,t)=>({...e,...t}),{}):void 0,n={...i,custom_privacy_request_fields:r},o=await l([n]);(0,ec.D4)(o)?a((0,ee.Vo)((0,H.e$)(o.error,"An error occurred while creating this privacy request. Please try again"))):a((0,ee.t5)("Privacy request created")),s()};return(0,i.jsxs)(n.u_l,{isOpen:t,onClose:s,size:"2xl",isCentered:!0,children:[(0,i.jsx)(n.ZAr,{}),(0,i.jsxs)(n.hzk,{"data-testid":"submit-request-modal",maxHeight:"80%",overflowY:"auto",children:[(0,i.jsx)(n.xBx,{children:"Create privacy request"}),(0,i.jsx)(n.fef,{children:(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsx)($.Z,{title:"Warning: You are bypassing identity verification",text:"You are bypassing Fides' built-in identity verification step. Please ensure that you are only entering information on behalf of a verified and approved user's privacy request."}),(0,i.jsx)(eu,{onSubmit:r,onCancel:()=>s()})]})})]})]})};var em=()=>{let{onOpen:e,isOpen:t,onClose:s}=(0,n.qY0)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ep,{isOpen:t,onClose:s}),(0,i.jsx)(n.wpx,{type:"primary",onClick:e,"data-testid":"submit-request-btn",children:"Create request"})]})},eh=s(58754),ex=s(14047);let ev=()=>{let{errorAlert:e}=(0,ex.V)(),[t,s]=(0,u.useState)(!1),[l,a]=(0,u.useState)({count:0,total:0}),[r,o]=(0,u.useState)(!0),d=_.q2.ERROR,{data:c}=(0,U.tE)(),{data:p}=(0,U.QA)({status:[d]},{pollingInterval:15e3,skip:r});return(0,u.useEffect)(()=>{o(!(c&&c.notify_after_failures>0))},[c]),(0,u.useEffect)(()=>{let e=(null==p?void 0:p.total)||0;e>=((null==c?void 0:c.notify_after_failures)||0)&&e>l.total?(a({count:e-l.total,total:e}),s(!0)):s(!1)},[null==p?void 0:p.total,null==c?void 0:c.notify_after_failures,l.total]),{processing:()=>{t&&e((0,i.jsxs)(n.xuv,{children:["DSR automation has failed for"," ",(0,i.jsx)(n.xvT,{as:"span",fontWeight:"semibold",children:l.count})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null,id:"dsrErrorAlert"})}}},ey={REQUEST:"request",MANUAL_TASK:"manual-tasks"},ej=()=>{let e=(0,m.useRouter)(),{flags:t}=(0,c.Vb)(),[s,l]=(0,u.useState)(ey.REQUEST),a=(0,u.useMemo)(()=>({request:!0,manualTask:t.alphaNewManualDSR}),[t.alphaNewManualDSR]),i=(0,u.useCallback)(e=>{let t=e.split("#");if(t.length<2)return null;let s=t[1];return Object.values(ey).includes(s)?s:null},[]),r=(0,u.useCallback)(t=>{let s="".concat(e.pathname,"#").concat(t);e.replace(s,void 0,{shallow:!0})},[e]);return(0,u.useEffect)(()=>{if(!e.isReady)return;let t=i(e.asPath);if(t&&(t===ey.REQUEST||t===ey.MANUAL_TASK&&a.manualTask)){l(t);return}l(ey.REQUEST),r(ey.REQUEST)},[e.isReady,e.asPath,e.pathname,a,i,r]),{activeTab:s,handleTabChange:(0,u.useCallback)(e=>{Object.values(ey).includes(e)&&(l(e),r(e))},[r]),availableTabs:a}},eg=d()(()=>s.e(9676).then(s.bind(s,59676)),{loadableGenerated:{webpack:()=>[59676]},loading:()=>(0,i.jsx)("div",{children:"Loading..."})});var eb=()=>{let{processing:e}=ev(),{plus:t}=(0,c.hz)(),{activeTab:s,handleTabChange:l,availableTabs:a}=ej();(0,u.useEffect)(()=>{e()},[e]);let r=(0,u.useMemo)(()=>{let e=[{key:ey.REQUEST,label:"Request",children:(0,i.jsx)(J,{})}];return a.manualTask&&e.push({key:ey.MANUAL_TASK,label:"Manual tasks",children:(0,i.jsx)(w,{})}),e},[a.manualTask]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eh.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests"}],rightContent:(0,i.jsxs)(n.vyj,{children:[t&&(0,i.jsx)(p.ZP,{scopes:[_.Sh.PRIVACY_REQUEST_CREATE],children:(0,i.jsx)(em,{})}),(0,i.jsx)(eg,{})]}),"data-testid":"privacy-requests"}),(0,i.jsx)(n.A5g,{activeKey:s,onChange:l,items:r})]})},e_=()=>(0,i.jsx)(r.Z,{title:"Privacy Requests",children:(0,i.jsx)(eb,{})})},31883:function(e,t,s){"use strict";s.d(t,{Bw:function(){return l.Bw},D4:function(){return l.D4}});var l=s(19043)}},function(e){e.O(0,[827,1169,2888,9774,179],function(){return e(e.s=1565)}),_N_E=e.O()}]);