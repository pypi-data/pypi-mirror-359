"use strict";(self.webpackChunkjupytercheckpoints=self.webpackChunkjupytercheckpoints||[]).push([[509],{509:(t,e,o)=>{o.r(e),o.d(e,{default:()=>u});var n=o(263),i=o(461),a=o(983),r=o(551),c=o(256);const d={id:"jupytercheckpoints:revert-button",description:"A JupyterLab extension adding a revert button to the toolbar.",autoStart:!0,requires:[n.INotebookTracker,i.IEditorTracker,a.IDocumentManager],activate:function(t,e,o,n){console.log("JupyterLab extension jupytercheckpoints:revert-button is activated!");const i={};function a(t){const e=n.contextForWidget(t);if(!e)return;if(i[e.path])return;const o=new r.ToolbarButton({className:"jp-RevertCheckpoint-button jp-mod-styled",icon:"fa fa-undo",label:"Revert Checkpoint",tooltip:"Revert file to previous checkpoint state",onClick:async()=>{try{const t=await e.listCheckpoints();if(0===t.length)return void(0,r.showDialog)({title:"没有检查点",body:"当前文件没有可用的检查点。",buttons:[r.Dialog.okButton()]});const o=document.createElement("div"),n=document.createElement("label");n.textContent="选择要恢复的检查点：",o.appendChild(n);const i=document.createElement("select");if(i.style.width="100%",i.style.marginTop="10px",t.forEach(t=>{const e=document.createElement("option");e.value=t.id,e.text=function(t){const e=function(t){return t.length>8?t.substring(0,8):t}(t.id),o=l(t.last_modified),n=new Date,i=new Date(t.last_modified),a=n.getTime()-i.getTime(),r=Math.round(a/6e4),c=Math.round(a/36e5),d=Math.round(a/864e5);let s;return s=r<60?`${r} 分钟前`:c<24?`${c} 小时前`:`${d} 天前`,`[id: ${e}] ${o} (${s})`}(t),i.appendChild(e)}),o.appendChild(i),(await(0,r.showDialog)({title:"选择一个检查点",body:new s(o),buttons:[r.Dialog.cancelButton(),r.Dialog.okButton()]})).button.accept){const o=i.value,n=t.find(t=>t.id===o);if(!n)return;const a=e.path.split("/").pop()||e.path,c=document.createElement("div"),d=document.createElement("p"),u=a.endsWith(".ipynb")?"Notebook":"文件";d.innerHTML=`您确定要将${u} <strong>${a}</strong> 恢复到检查点状态吗？<strong>此操作无法撤消。</strong>`,c.appendChild(d);const p=document.createElement("p"),h=new Date(n.last_modified),g=(new Date).getTime()-h.getTime();let m;const b=Math.round(g/6e4),f=Math.round(g/36e5),k=Math.round(g/864e5);m=b<60?`${b} 分钟前`:f<24?`${f} 小时前`:`${k} 天前`,p.innerHTML="检查点最后更新时间：";const y=document.createElement("p");if(y.style.textAlign="center",y.textContent=`${l(n.last_modified)} (${m})`,p.appendChild(y),c.appendChild(p),(await(0,r.showDialog)({title:`恢复${u}到检查点`,body:new s(c),buttons:[r.Dialog.cancelButton({label:"取消"}),r.Dialog.warnButton({label:"恢复"})]})).button.accept)try{const t=document.createElement("div");t.className="jp-Dialog-busy",document.body.appendChild(t);try{await e.restoreCheckpoint(o),e.model.dirty=!1,await e.revert()}finally{t&&t.parentNode&&t.parentNode.removeChild(t)}}catch(t){console.error("Error restoring checkpoint:",t),(0,r.showDialog)({title:"恢复检查点失败",body:`恢复检查点时出错: ${t}`,buttons:[r.Dialog.okButton()]})}}}catch(t){console.error("Error listing or restoring checkpoints:",t),(0,r.showDialog)({title:"错误",body:`获取或恢复检查点时出错: ${t}`,buttons:[r.Dialog.okButton()]})}}});t.toolbar.insertItem(10,"revertCheckpoint",o),i[e.path]=o}e.forEach(a),o.forEach(a),e.widgetAdded.connect((t,e)=>{a(e)}),o.widgetAdded.connect((t,e)=>{a(e)}),setInterval(()=>{Object.keys(i).forEach(t=>{e.find(e=>n.contextForWidget(e)?.path===t)||o.find(e=>n.contextForWidget(e)?.path===t)||i[t]&&(i[t].dispose(),delete i[t])})},5e3)}};function l(t){return new Date(t).toLocaleString()}class s extends c.Widget{constructor(t){super(),this.addClass("jp-RevertCheckpoint-dialog"),this.node.appendChild(t)}}const u=d}}]);
//# sourceMappingURL=509.6ed692b6959efb0b1eb8.js.map?v=6ed692b6959efb0b1eb8