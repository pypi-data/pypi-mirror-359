import{b as P,u as M,h as $,g as f,d as J,c as d,k as _,a,e as k,w as e,p as j,l as c,t as o,f as u,i as K,o as s,j as q,K as Q,F as z}from"./index-C5325MdZ.js";import{c as H,b as W,a as X,_ as Y}from"./DomainTransportForm-uJ4BNljH.js";import{L as Z}from"./LoadingData-CoKjQ2u-.js";import{p as ee}from"./parameters-CkHETJ4h.js";import{_ as ae}from"./ResourcesForm-CM_jJ5xf.js";import{d as G}from"./domains-Bs7FLJ1R.js";import{f as N,d as E,V as O}from"./index-B-rQUgVu.js";import{V,c as F,a as h,b as le}from"./VExpansionPanels-DzI7CVcM.js";import{V as p,a as i}from"./VRow-BA1qwRZ9.js";import{V as te,a as oe}from"./VToolbar-CD_Pei8V.js";import"./ChoiceField-DDap1Bg3.js";import"./VForm-CdezjhrD.js";import"./tag-D2dRSi3w.js";import"./VTextField-Mh45fVxn.js";import"./VProgressCircular-CYaqOboK.js";import"./forwardRefs-Dlri9WEl.js";import"./ssrBoot-Bg1BB49m.js";import"./VAvatar-Dy7UDVH7.js";import"./VSwitch-ttoecpo6.js";import"./VSelectionControl-Be4ap0Uu.js";import"./VAutocomplete-oTV4rvNw.js";import"./VSelect-u6ThbkAk.js";import"./VMenu-CWF66mQ3.js";import"./VCheckboxBtn-etQtUaSH.js";import"./VChip-D4ncb36B.js";import"./filter-BzMmSywX.js";import"./VCheckbox-DcRkEdT-.js";import"./VContainer-DhiTykbN.js";/* empty css              */const se={key:1},ue={key:0},re={key:0},ne={key:0},ie={class:"mr-2"},me={class:"mr-2"},de={class:"mr-2"},ce={key:0},fe={class:"mr-2"},pe={class:"mt-4 d-flex justify-end"},_e={__name:"DomainEditForm",props:{domain:{type:Object,default:null}},setup(R){const x=K(),{$gettext:r}=P(),b=M(),D=R,v=$(()=>b.authUser),y=f({}),S=f(0),g=f(!1),l=$(()=>D.domain),U=f(),C=f(),T=f(),A=f(),B=f(),I=$(()=>{const m={generalForm:U,limitationForm:A,dnsForm:B};return l.value.type==="relaydomain"&&(m.transportForm=T),y.value.params&&y.value.params.enable_domain_limits&&(v.value.role==="SuperAdmins"||v.value.role==="Resellers")&&(m.resourcesForm=C),m}),w=f(!1);async function L(){w.value=!1,S.value=[];for(const[m,n]of Object.entries(I.value))if(n.value!=null){const{valid:t}=await n.value.vFormRef.validate();t||(w.value=!0,S.value.push(m))}if(!w.value){g.value=!0;try{const m=JSON.parse(JSON.stringify(l.value));m.transport===null&&delete m.transport,m.type==="relaydomain"&&T.value.checkSettingTypes(m),m.message_limit===""&&(m.message_limit=null),await G.updateDomain(l.value.pk,m),x.push({name:"DomainDetail",params:{id:l.value.pk}})}finally{g.value=!1}}}return J(()=>{ee.getGlobalApplication("limits").then(m=>{y.value.data=m.data})}),(m,n)=>g.value?(s(),d(Z,{key:0})):(s(),_("div",se,[a(le,{modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=t=>S.value=t),multiple:w.value},{default:e(()=>[a(V,{eager:"",value:"generalForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(p,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("General")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[t?(s(),_("span",ue)):(s(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Name: "))+" "+o(l.value.name),1)]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Type: "))+" "+o(l.value.type),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(H,{ref_key:"generalForm",ref:U,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{eager:"",value:"dnsForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(p,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("DNS")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[t?(s(),_("span",re)):(s(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DNS checks"))+" ",1),l.value.enable_dns_checks?(s(),d(E,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(E,{key:1,icon:"mdi-check-circle-outline"}))]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DKIM signing"))+" ",1),l.value.enable_dkim?(s(),d(E,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(E,{key:1,icon:"mdi-close-circle-outline"}))]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(W,{ref_key:"dnsForm",ref:B,modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{eager:"",value:"limitationForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(p,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Limitations")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[t?(s(),_("span",ne)):(s(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[k("div",ie,o(u(r)("Quota: "))+" "+o(l.value.quota),1)]),_:1}),l.value.message_limit?(s(),d(i,{key:0,cols:"6"},{default:e(()=>[k("div",me,o(u(r)("Sending limit: "))+" "+o(l.value.message_limit),1)]),_:1})):(s(),d(i,{key:1,cols:"6"},{default:e(()=>[k("div",de,o(u(r)("No sending limit")),1)]),_:1}))]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(X,{ref_key:"limitationForm",ref:A,modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),l.value.type==="relaydomain"?(s(),d(V,{key:0,value:"transportForm",eager:""},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(p,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Transport")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[t?(s(),_("span",ce)):(s(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[k("div",fe,o(u(r)("Service: "))+" "+o(l.value.transport.service),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(Y,{ref_key:"transportForm",ref:T,modelValue:l.value.transport,"onUpdate:modelValue":n[3]||(n[3]=t=>l.value.transport=t)},null,8,["modelValue"])]),_:1})]),_:1})):j("",!0),y.value.params&&y.value.params.enable_domain_limits&&(v.value.role==="SuperAdmins"||v.value.role==="Resellers")?(s(),d(V,{key:1,value:"resourcesForm",eager:""},{default:e(()=>[a(F,null,{default:e(()=>[a(p,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Resources")),1)]),_:1})]),_:1})]),_:1}),a(h,null,{default:e(()=>[a(ae,{ref_key:"resourcesForm",ref:C,modelValue:l.value.resources,"onUpdate:modelValue":n[4]||(n[4]=t=>l.value.resources=t)},null,8,["modelValue"])]),_:1})]),_:1})):j("",!0)]),_:1},8,["modelValue","multiple"]),k("div",pe,[a(O,{loading:g.value,onClick:n[6]||(n[6]=t=>u(x).go(-1))},{default:e(()=>[c(o(u(r)("Cancel")),1)]),_:1},8,["loading"]),a(O,{class:"ml-4",color:"primary darken-1",loading:g.value,onClick:L},{default:e(()=>[c(o(u(r)("Save")),1)]),_:1},8,["loading"])])]))}},ve={__name:"DomainEditView",setup(R){const{$gettext:x}=P(),r=Q(),b=f({});return G.getDomain(r.params.id).then(D=>{b.value=D.data}),(D,v)=>(s(),_(z,null,[a(te,{flat:""},{default:e(()=>[a(oe,null,{default:e(()=>[c(o(u(x)("Edit domain")),1)]),_:1})]),_:1}),a(u(_e),{domain:b.value},null,8,["domain"])],64))}},qe=q(ve,[["__scopeId","data-v-0190c88d"]]);export{qe as default};
