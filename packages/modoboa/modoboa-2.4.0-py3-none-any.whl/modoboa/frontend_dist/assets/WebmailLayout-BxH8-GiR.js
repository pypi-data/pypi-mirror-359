import{j as ee,aX as Q,aY as ae,K,m as j,g as r,J as z,r as le,k as g,o as c,F as I,D as te,G as A,e as N,c as R,p as T,a,f as y,t as B,n as G,b as P,h as q,w as f,i as oe}from"./index-C5325MdZ.js";import{_ as ne,V as ie,a as se}from"./ConnectedLayout-C_XIIKhP.js";import{_ as re}from"./ConfirmDialog-OyFwr1te.js";import{a as _}from"./webmail-D2d-AEcf.js";import{d as W,V as L,e as ue,o as me}from"./index-B-rQUgVu.js";import{V as Y}from"./VSpacer-CpiIQIqb.js";import{V as de,r as ce}from"./VForm-CdezjhrD.js";import{a as pe,b as ve,c as fe}from"./VCard-COPSw5az.js";import{V as be}from"./VTextField-Mh45fVxn.js";import{V as xe}from"./VDialog-DHYtTXqV.js";import{V as ge}from"./VMenu-CWF66mQ3.js";import{V as ye,a as F}from"./forwardRefs-Dlri9WEl.js";import"./VContainer-DhiTykbN.js";/* empty css              */import"./tag-D2dRSi3w.js";import"./VApp-DOKhYvT_.js";import"./layout-DON_nm1n.js";import"./ssrBoot-Bg1BB49m.js";import"./global.store-D9HjM5Ng.js";import"./layout.store-g0jC3Kvh.js";import"./VProgressCircular-CYaqOboK.js";import"./VRow-BA1qwRZ9.js";import"./VSheet-KcHLba8T.js";import"./VAvatar-Dy7UDVH7.js";import"./VToolbar-CD_Pei8V.js";const Me=["onClick","onMouseover","onMouseleave"],Ve={key:0,class:"font-weight-bold"},_e={key:1},he={key:0,class:"font-weight-bold"},Ce={key:1},ke={__name:"MailboxList",props:Q({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:Q(["update:modelValue"],["update:modelValue"]),setup(S,{emit:s}){const t=S,b=ae(S,"modelValue"),i=s,h=K(),u=j(),M={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},m=r(null),C=r({}),o=r({});function d(e){return e.label.split("/").pop()}function V(e){return m.value===null&&(m.value=e.unseen),m.value}function x(e,w){C.value[e.name]=w}function n(e){return b.value===e.name?"bg-primary-lighten-1":t.lightMode?C.value[e.name]?"bg-primary":"bg-white":C.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function k(e){return o.value[e.name]}function D(e){o.value[e.name]||(o.value[e.name]=!1),o.value[e.name]=!o.value[e.name],o.value[e.name]&&!e.sub.length&&_.getUserMailboxes(e.name).then(w=>{e.sub=w.data.mailboxes})}function O(e){t.allowUnselect&&e===b.value?i("update:modelValue",null):i("update:modelValue",e)}return z(()=>u.mbCounterKey,()=>{_.getUserMailboxUnseen(h.query.mailbox).then(e=>{m.value=e.data.counter})}),(e,w)=>{const X=le("MailboxList",!0);return c(),g("div",null,[(c(!0),g(I,null,te(t.mailboxes,l=>(c(),g("div",{key:l.name,class:A(["pl-3 text-body-2",{"py-1":!t.compact}])},[N("div",{class:A([n(l),"d-flex mailbox pa-1 align-center"]),onClick:U=>O(l.name),onMouseover:U=>x(l,!0),onMouseleave:U=>x(l,!1)},[a(W,{icon:M[l.type],class:"mr-4"},null,8,["icon"]),l.name===y(h).query.mailbox?(c(),g(I,{key:0},[m.value>0?(c(),g("span",Ve,B(d(l))+" ("+B(V(l))+") ",1)):(c(),g("span",_e,B(d(l)),1))],64)):(c(),g(I,{key:1},[l.unseen>0?(c(),g("span",he,B(d(l))+" ("+B(l.unseen)+") ",1)):(c(),g("span",Ce,B(d(l)),1))],64)),a(Y),l.sub?(c(),R(L,{key:2,icon:k(l)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:G(U=>D(l),["stop"])},null,8,["icon","onClick"])):T("",!0)],42,Me),k(l)&&l.sub&&l.sub.length?(c(),R(X,{key:0,modelValue:b.value,"onUpdate:modelValue":w[0]||(w[0]=U=>b.value=U),mailboxes:l.sub,class:"mt-1","light-mode":t.lightMode,compact:t.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):T("",!0)],2))),128))])}}},H=ee(ke,[["__scopeId","data-v-62d5beb0"]]),we={class:"mb-2 rounded-lg"},Ue={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:s}){const t=S,b=s,{$gettext:i}=P(),{displayNotification:h}=j(),u=r({}),M=r(),m=r(!1),C=q(()=>t.mailbox?i("Edit mailbox"):i("Create new mailbox")),o=q(()=>t.mailbox?i("Update"):i("Create")),d=()=>{u.value={},b("close")},V=async()=>{const{valid:x}=await M.value.validate();if(x){m.value=!0;try{const n={...u.value};t.mailbox?(n.oldname=t.mailbox,await _.renameUserMailbox(n),h({msg:i("Mailbox renamed")}),b("mailboxRenamed",`${n.parent_mailbox}${t.hdelimiter}${n.name}`)):(await _.createUserMailbox(n),h({msg:i("Mailbox created")})),d()}finally{m.value=!1}}};return z(()=>t.mailbox,x=>{if(x){const n=t.mailbox.split(t.hdelimiter);u.value.name=n.slice(-1)[0],u.value.parent_mailbox=n.slice(0,-1).join(t.hdelimiter)}else u.value={}},{immediate:!0}),(x,n)=>(c(),R(fe,{title:C.value},{default:f(()=>[a(pe,null,{default:f(()=>[a(de,{ref_key:"formRef",ref:M},{default:f(()=>[a(be,{modelValue:u.value.name,"onUpdate:modelValue":n[0]||(n[0]=k=>u.value.name=k),label:y(i)("Name"),variant:"outlined",density:"compact",rules:[y(ce).required]},null,8,["modelValue","label","rules"]),N("div",we,[N("h4",null,B(y(i)("Parent mailbox")),1),a(H,{modelValue:u.value.parent_mailbox,"onUpdate:modelValue":n[1]||(n[1]=k=>u.value.parent_mailbox=k),"active-mailbox":t.parent,mailboxes:t.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(ve,null,{default:f(()=>[a(Y),a(L,{text:y(i)("Close"),variant:"flat",loading:m.value,onClick:d},null,8,["text","loading"]),a(L,{text:o.value,variant:"tonal",color:"primary",loading:m.value,onClick:V},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},$e={class:"d-flex align-center"},Be={class:"d-flex justify-center mb-4"},Ne={class:"border-t-sm d-flex align-center bg-grey"},la={__name:"WebmailLayout",setup(S){const{$gettext:s}=P(),t=K(),b=oe(),i=j(),h=r(),u=r(!0),M=r(!1),m=r(null),C=r(null),o=r(null),d=r(t.query.mailbox||"INBOX"),V=r(!1),x=r([]),n=q(()=>["INBOX"].includes(t.query.mailbox||"INBOX")),k=q(()=>o.value.usage<50?"info":o.value.usage<80?"warning":"error"),D=q(()=>`${o.value.current} / ${o.value.limit} (${o.value.usage}%)`);function O(p){b.push({name:"MailboxView",query:{mailbox:p}}),_.getUserMailboxQuota(p).then(v=>{o.value=v.data})}const e=()=>{_.getUserMailboxes().then(p=>{x.value=p.data.mailboxes,C.value=p.data.hdelimiter})},w=()=>{b.push({name:"ComposeEmailView"})},X=()=>{V.value=!1,m.value=null,e()},l=()=>{V.value=!0},U=()=>{m.value=d.value,V.value=!0},E=p=>{d.value=p,b.push({name:"MailboxView",query:{mailbox:p}})},J=async()=>{await _.compressUserMailbox({name:d.value}),i.displayNotification({msg:s("Mailbox compressed")})},Z=async()=>{await h.value.open(s("Warning"),s("Delete this mailbox?"),{color:"warning",agreeLabel:s("Yes"),cancelLabel:s("No")})&&(await _.deleteUserMailbox({name:d.value}),i.displayNotification({msg:s("Mailbox deleted")}),E("INBOX"))};return z(()=>i.dataKey,()=>{e()}),e(),_.getUserMailboxQuota(t.query.mailbox||"INBOX").then(p=>{o.value=p.data}),(p,v)=>(c(),g(I,null,[a(ne,null,{navbar:f(()=>[a(ie,{modelValue:u.value,"onUpdate:modelValue":v[2]||(v[2]=$=>u.value=$),rail:M.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[N("div",$e,[a(me,{src:se,"max-width":"190",class:"logo"}),a(L,{icon:M.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=G($=>M.value=!M.value,["stop"]))},null,8,["icon"])]),N("div",Be,[a(L,{text:y(s)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:w},null,8,["text"])])]),append:f(()=>[N("div",Ne,[a(L,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(W,{icon:"mdi-cog"}),a(ge,{activator:"parent"},{default:f(()=>[a(ye,{density:"compact"},{default:f(()=>[a(F,{title:y(s)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:l},null,8,["title"]),a(F,{title:y(s)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:n.value,onClick:U},null,8,["title","disabled"]),a(F,{title:y(s)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:n.value,onClick:Z},null,8,["title","disabled"]),a(F,{title:y(s)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:J},null,8,["title"])]),_:1})]),_:1})]),_:1}),o.value?(c(),R(ue,{key:0,color:k.value,"model-value":o.value.usage,title:D.value},null,8,["color","model-value","title"])):T("",!0)])]),default:f(()=>[a(H,{modelValue:d.value,"onUpdate:modelValue":[v[1]||(v[1]=$=>d.value=$),O],mailboxes:x.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(xe,{modelValue:V.value,"onUpdate:modelValue":v[4]||(v[4]=$=>V.value=$),"max-width":"800"},{default:f(()=>[a(Ue,{"user-mailboxes":x.value,mailbox:m.value,hdelimiter:C.value,onMailboxRenamed:E,onClose:v[3]||(v[3]=$=>X())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(re,{ref_key:"confirm",ref:h},null,512)],64))}};export{la as default};
