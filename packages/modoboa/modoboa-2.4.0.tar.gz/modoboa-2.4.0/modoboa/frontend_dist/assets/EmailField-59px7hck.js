import{M as I,g as n,j as b,b as z,h,d as F,$ as B,a0 as T,a1 as U,k as S,o as v,a as V,p as N,z as W,a2 as j,w as D,F as M,D as G,c as K,G as O,l as P,t as R}from"./index-C5325MdZ.js";import{d as q}from"./domains-Bs7FLJ1R.js";import{V as H}from"./VTextField-Mh45fVxn.js";import{a as J,b as Q,V as X}from"./forwardRefs-Dlri9WEl.js";const Y=I("domains",()=>{const r=n(!1),u=n({});async function p(){r.value=!1,u.value={}}async function i(){r.value=!1;try{const s=await q.getDomains();u.value=s.data}finally{r.value=!1}}return{domainsLoaded:r,domains:u,getDomains:i,$reset:p}}),Z={__name:"EmailField",props:{modelValue:{type:String,default:""},allowAdd:{type:Boolean,default:!1},role:{type:String,default:"SimpleUsers"},errorMsg:{type:Array,default:()=>[]}},emits:["domain-selected","update:model-value"],setup(r,{emit:u}){const{$gettext:p}=z(),i=Y(),s=r,k=u,d=h({get(){return s.modelValue},set(e){c.value=[],e.indexOf("@")!==-1?s.role!=="SuperAdmins"?(f.value=e.split("@")[1],s.allowAdd?a.value=o.value.length>0:a.value=!0):c.value=[p("SuperAdmins cannot own a mailbox")]:a.value=!1,k("update:model-value",e)}}),o=h(()=>Object.values(i.domains).filter(e=>e.name.startsWith(f.value))),c=h({get(){return[...A.value,...s.errorMsg]},set(e){A.value=e}}),f=n(""),l=n(0),a=n(!1),x=n(500),_=n(),A=n([]);function $(e){if(s.role==="SuperAdmins")return;const t=e.keyCode;t===40||t===34?(a.value?C():(f.value="",a.value=!0),e.preventDefault()):t===38||t===33?(a.value?E():(f.value="",a.value=!0),e.preventDefault()):t===13||t===9?(o.value.length>0?g(o.value[l.value]):s.allowAdd&&g(),e.preventDefault()):t===27&&o.value.length>0&&(a.value=!1,e.preventDefault())}function C(){l.value>=o.value.length-1?l.value=0:l.value+=1}function E(){l.value<=0?l.value=o.value.length-1:l.value-=1}function g(e){e!==void 0&&(d.value=d.value.split("@")[0]+"@"+e.name),a.value=!1,k("domain-selected")}function y(){x.value=_.value.$el.clientWidth}return F(()=>{i.getDomains(),window.addEventListener("resize",y)}),B(()=>{window.removeEventListener("resize",y)}),T(()=>{U(()=>{y()})}),(e,t)=>(v(),S(M,null,[V(H,W({ref_key:"inputRef",ref:_,modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=m=>d.value=m),variant:"outlined"},e.$attrs,{"error-messages":c.value,error:c.value.length>0,density:"compact",autocomplete:"new-password",onKeydown:$}),null,16,["modelValue","error-messages","error"]),a.value?(v(),S("div",{key:0,class:"menu",style:j(`width: ${x.value}px;`)},[V(X,{class:"list"},{default:D(()=>[(v(!0),S(M,null,G(o.value,(m,w)=>(v(),K(J,{key:w,class:O(l.value===w?"bg-primary-lighten-1":""),onClick:L=>g(m),onMouseenter:L=>l.value=w},{default:D(()=>[V(Q,null,{default:D(()=>[P(R(m.name),1)]),_:2},1024)]),_:2},1032,["class","onClick","onMouseenter"]))),128))]),_:1})],4)):N("",!0)],64))}},se=b(Z,[["__scopeId","data-v-f4a8114a"]]);export{se as E,Y as u};
