<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>philander.l6924 &#8212; philander 0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script src="../../_static/documentation_options.js?v=b489f392"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for philander.l6924</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Driver implementation for the L6924D/U battery chargers.</span>

<span class="sd">More information on the functionality of the chip can be found at</span>
<span class="sd">the ST website under e.g. https://www.st.com/en/power-management/l6942d.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Carl Bellgardt&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L6924&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">philander.charger</span> <span class="kn">import</span> <span class="n">Charger</span><span class="p">,</span> <span class="n">Status</span><span class="p">,</span> <span class="n">DCStatus</span><span class="p">,</span> <span class="n">PowerSrc</span><span class="p">,</span> <span class="n">ChargerError</span><span class="p">,</span> <span class="n">TemperatureRating</span>
<span class="kn">from</span> <span class="nn">philander.battery</span> <span class="kn">import</span> <span class="n">Status</span> <span class="k">as</span> <span class="n">BatStatus</span>
<span class="kn">from</span> <span class="nn">philander.gpio</span> <span class="kn">import</span> <span class="n">GPIO</span>
<span class="kn">from</span> <span class="nn">philander.sysfactory</span> <span class="kn">import</span> <span class="n">SysFactory</span>
<span class="kn">from</span> <span class="nn">philander.systypes</span> <span class="kn">import</span> <span class="n">ErrorCode</span>

<div class="viewcode-block" id="L6924">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924">[docs]</a>
<span class="k">class</span> <span class="nc">L6924</span><span class="p">(</span><span class="n">Charger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;L6924 driver implementation.</span>

<span class="sd">    This implementation was tested using STEVAL-ISA076V1 board (based on L6924D) but also should work for other devices.</span>
<span class="sd">    This implementation does only read information on two gpio pins, and thus cannot communicate with the charger in any way.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt2</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="L6924.Params_init">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.Params_init">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Params_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">paramDict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes configuration parameters with defaults.</span>
<span class="sd">        </span>
<span class="sd">        The following settings are supported:</span>
<span class="sd">        </span>
<span class="sd">        =================================    ==========================================================================================================</span>
<span class="sd">        Key name                             Value type, meaning and default</span>
<span class="sd">        =================================    ==========================================================================================================</span>
<span class="sd">        All L6924.[St1 | St2].gpio.* settings as documented at :meth:`.GPIO.Params_init`.</span>
<span class="sd">        ===============================================================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        Also see: :meth:`.Charger.Params_init`, :meth:`.SerialBusDevice.Params_init`, :meth:`.GPIO.Params_init`. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpio_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;gpio.direction&quot;</span><span class="p">:</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">DIRECTION_IN</span><span class="p">,</span>
            <span class="s2">&quot;gpio.pull&quot;</span><span class="p">:</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">,</span>
            <span class="s2">&quot;gpio.inverted&quot;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span><span class="n">gpio_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gpio_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;L6924.St1.&quot;</span><span class="p">,</span> <span class="s2">&quot;L6924.St2.&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">pin</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">paramDict</span><span class="p">[</span><span class="n">pin</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">paramDict</span></div>


<div class="viewcode-block" id="L6924.open">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.open">[docs]</a>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramDict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens the instance and sets it in a usable state.</span>

<span class="sd">        Allocate necessary hardware resources and configure</span>
<span class="sd">        user-adjustable parameters to meaningful defaults.</span>
<span class="sd">        In this case the two GPIO-Pins for reading the charger status</span>
<span class="sd">        are initialized.</span>
<span class="sd">        This function must be called prior to any further usage of the</span>
<span class="sd">        instance. Involving it in the system ramp-up procedure could be</span>
<span class="sd">        a good choice. After usage of this instance is finished, the</span>
<span class="sd">        application should call :meth:`close`.</span>
<span class="sd">        </span>
<span class="sd">        :param paramDict(str, object) paramDict: Configuration parameters as obtained from :meth:`Params_init`, possibly.</span>
<span class="sd">        :return: An error code indicating either success or the reason of failure.</span>
<span class="sd">        :rtype: ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span><span class="n">paramDict</span><span class="p">)</span>
        <span class="c1"># init St1 and St2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt1</span> <span class="o">=</span> <span class="n">SysFactory</span><span class="o">.</span><span class="n">getGPIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt2</span> <span class="o">=</span> <span class="n">SysFactory</span><span class="o">.</span><span class="n">getGPIO</span><span class="p">()</span>
        <span class="n">st1_params</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># collector requires pull-up to be readable</span>
        <span class="n">st2_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L6924.St1&quot;</span><span class="p">):</span>
                <span class="n">st1_params</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L6924.St1.&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L6924.St2&quot;</span><span class="p">):</span>
                <span class="n">st2_params</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;L6924.St2.&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># open GPIO pins</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">():</span>
            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt1</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">st1_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">():</span>
            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt2</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">st2_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">err</span></div>

        
<div class="viewcode-block" id="L6924.close">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shut down the device after usage.</span>
<span class="sd">        </span>
<span class="sd">        This method should be called when the device is not used, anymore,</span>
<span class="sd">        e.g. as part of the application exit procedure.</span>
<span class="sd">        The following steps are executed:</span>
<span class="sd">        </span>
<span class="sd">        * close GPIO pins for st1 and st1</span>
<span class="sd">        </span>
<span class="sd">        After return, the device can still be re-used, by calling</span>
<span class="sd">        :meth:`.open` again.</span>
<span class="sd">        </span>
<span class="sd">        Also see: :meth:`.GPIO.close`, :meth:`.Module.close`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">():</span>
            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">err</span></div>


<div class="viewcode-block" id="L6924.reset">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Soft resets the device.</span>
<span class="sd">        </span>
<span class="sd">        As there is nothing to reset, this routine does not execute an actual reset.</span>
<span class="sd">        It is just here to fulfill the interface.</span>
<span class="sd">        </span>
<span class="sd">        The device is in some default state, afterwards and must be</span>
<span class="sd">        re-configured according to the application&#39;s needs.</span>
<span class="sd">        :return: An error code indicating either success or the reason of failure.</span>
<span class="sd">        :rtype: ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span> <span class="c1"># nothing to do here</span></div>

    
<div class="viewcode-block" id="L6924.getInfo">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getInfo">[docs]</a>
    <span class="k">def</span> <span class="nf">getInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves an information block from the charging device.</span>
<span class="sd">        </span>
<span class="sd">        This device does not report any static information.</span>

<span class="sd">        :return: The information object and an error code indicating either success or the reason of failure.</span>
<span class="sd">        :rtype: Info, ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span></div>

    
<div class="viewcode-block" id="L6924.isBatteryPresent">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.isBatteryPresent">[docs]</a>
    <span class="k">def</span> <span class="nf">isBatteryPresent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks, if the battery is present.</span>
<span class="sd">        </span>
<span class="sd">        Because there is only one error code without any differentiation,</span>
<span class="sd">        if Error.errUnavailable is returned, it could be the case, that there is no battery present.</span>
<span class="sd">        Specifically the following is true:</span>
<span class="sd">        If there is no battery present, this function will return Error.errUnavailable.</span>
<span class="sd">        If the function returns Error.errUnavailable, the reason could also be a high/low temperature, a faulty battery</span>
<span class="sd">        or that the time limit has elapsed.</span>
<span class="sd">        If the chip is not powered, it will always return ErrorCode.errOk, guessing that there is a battery present.</span>
<span class="sd">        </span>
<span class="sd">        Returns :attr:`ErrorCode.errOk` if a battery is present,</span>
<span class="sd">        :attr:`ErrorCode.errUnavailable` if the battery could possibly not be present.\</span>
<span class="sd">        This can not be exactly determined, because there is only one error state,\</span>
<span class="sd">        which could indicate that the battery is not present, but which also could indicate\</span>
<span class="sd">        another problem.</span>
<span class="sd">        </span>
<span class="sd">        See also: :meth:`getChgStatus`.</span>

<span class="sd">        :return: An error code.</span>
<span class="sd">        :rtype: ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Status</span><span class="o">.</span><span class="n">unknown</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errUnavailable</span>
        <span class="k">return</span> <span class="n">err</span></div>

    
<div class="viewcode-block" id="L6924.getNumCells">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getNumCells">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the number of battery cells configured.</span>
<span class="sd">        </span>
<span class="sd">        This board only supports one cell.</span>

<span class="sd">        :return: The number of cells.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span></div>

    
<div class="viewcode-block" id="L6924.getBatStatus">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getBatStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getBatStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the battery status to tell about the health and state of the battery.</span>
<span class="sd">        </span>
<span class="sd">        Returns one of the :class:`.battery.Status` values to indicate</span>
<span class="sd">        battery voltage level or presence or health state.</span>
<span class="sd">        Because of the very limited output, this will only return the states\</span>
<span class="sd">        Status.normal (charging, etc.) and Status.problemPhysical (Battery absent, too hot, etc.)</span>

<span class="sd">        :return: The battery state.</span>
<span class="sd">        :rtype: battery.Status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chg_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">off</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">fastCharge</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">low</span> <span class="o">|</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">empty</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">nomal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">removed</span> <span class="o">|</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">broken</span> <span class="o">|</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">problemThermal</span>
        <span class="k">return</span> <span class="n">status</span></div>

    
<div class="viewcode-block" id="L6924.getChgStatus">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getChgStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getChgStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the charging phase or status.</span>
<span class="sd">        </span>
<span class="sd">        :return: A charger status code to indicate the current charger status.</span>
<span class="sd">        :rtype: charger.Status</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">st1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt1</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="c1"># collector state is the inverted state of internal transistor (GPIO.inverted should be true)</span>
        <span class="n">st2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinSt2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="c1"># (see data sheet table for possible states)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">st1</span> <span class="ow">or</span> <span class="n">st2</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">off</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">st1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">st2</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">done</span>
        <span class="k">elif</span> <span class="n">st1</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">st2</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">fastCharge</span> <span class="c1"># The board only outputs a general charging status, thus this could mean any kind of charging</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">unknown</span> <span class="c1"># this could indicate any error</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="L6924.getDCStatus">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getDCStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getDCStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the DC supply status.</span>

<span class="sd">        This device does not indicate it&#39;s status.</span>
<span class="sd">        The given status is guessed based on the ChgStatus.</span>

<span class="sd">        :return: A status code to indicate the DC supply status.</span>
<span class="sd">        :rtype: DCStatus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chg_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">off</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">off</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">fastCharge</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">valid</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">nomal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">return</span> <span class="n">status</span></div>

    
<div class="viewcode-block" id="L6924.getPowerSrc">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getPowerSrc">[docs]</a>
    <span class="k">def</span> <span class="nf">getPowerSrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the power source, that presumably drives the\</span>
<span class="sd">        system at the moment that this function is executed.</span>
<span class="sd">        </span>
<span class="sd">        This device does not report it&#39;s power source.</span>
<span class="sd">        The given status is guessed based on the ChgStatus.</span>
<span class="sd">        </span>
<span class="sd">        :return: A code to indicate the power source.</span>
<span class="sd">        :rtype: PowerSrc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chg_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">off</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">bat</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">fastCharge</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">dc</span>
        <span class="k">elif</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">dcBat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="L6924.getChargerTempStatus">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getChargerTempStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getChargerTempStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the charger&#39;s temperature state.</span>

<span class="sd">        This device does not report it&#39;s temperature.</span>

<span class="sd">        :return: A rating code to indicate the temperature rating of the charger chip.</span>
<span class="sd">        :rtype: TemperatureRating</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">unknown</span></div>



<div class="viewcode-block" id="L6924.getBatteryTempStatus">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getBatteryTempStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getBatteryTempStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the battery&#39;s temperature status.</span>

<span class="sd">        This device does not report on the battery&#39;s temperature.</span>
<span class="sd">        The given status is guessed based on the ChgStatus.</span>
<span class="sd">        If the charger status is ok, the battery temperature is assumed to be ok too.</span>
<span class="sd">        If the charger status is indicating any problem, the temperature rating is assumed to be unknown.</span>

<span class="sd">        :return: A rating code to indicate the temperature rating of the battery element.</span>
<span class="sd">        :rtype: TemperatureRating</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chg_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">chg_status</span> <span class="o">==</span> <span class="n">Status</span><span class="o">.</span><span class="n">unknown</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">ok</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="L6924.getError">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.getError">[docs]</a>
    <span class="k">def</span> <span class="nf">getError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines the error state for the charger chip, if one.</span>

<span class="sd">        Because this device only has one error status, ChargerError.bat indicates any kind of error</span>
<span class="sd">        e.g. thermal problems, battery absent or charge timer expired.</span>

<span class="sd">        :return: A charger error code to further describe reason for the error.</span>
<span class="sd">        :rtype: ChargerError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">ok</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChgStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Status</span><span class="o">.</span><span class="n">unknown</span> <span class="k">else</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">bat</span> 
        <span class="k">return</span> <span class="n">err</span></div>


<div class="viewcode-block" id="L6924.restartCharging">
<a class="viewcode-back" href="../../philander.html#philander.l6924.L6924.restartCharging">[docs]</a>
    <span class="k">def</span> <span class="nf">restartCharging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tries to restart the charging phase.</span>
<span class="sd">        </span>
<span class="sd">        This device does not support manual control of the charging process.</span>

<span class="sd">        :return: An error code indicating either success or the reason of failure.</span>
<span class="sd">        :rtype: ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span> <span class="c1"># nothing to do here</span></div>
</div>


    
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">philander</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">philander</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2024, Oliver Maye.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>