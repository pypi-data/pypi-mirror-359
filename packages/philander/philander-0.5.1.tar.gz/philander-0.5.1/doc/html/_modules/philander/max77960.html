<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>philander.max77960 &#8212; philander 0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script src="../../_static/documentation_options.js?v=b489f392"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for philander.max77960</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Support module for the MAX77960 USB battery charger.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Oliver Maye&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MAX77960&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">philander.max77960_reg</span> <span class="kn">import</span> <span class="n">MAX77960_Reg</span>

<span class="kn">from</span> <span class="nn">philander.battery</span> <span class="kn">import</span> <span class="n">Status</span> <span class="k">as</span> <span class="n">BatStatus</span>
<span class="kn">from</span> <span class="nn">philander.charger</span> <span class="kn">import</span> <span class="n">Charger</span><span class="p">,</span> <span class="n">Status</span> <span class="k">as</span> <span class="n">ChgStatus</span><span class="p">,</span> <span class="n">DCStatus</span><span class="p">,</span> <span class="n">PowerSrc</span><span class="p">,</span>\
    <span class="n">TemperatureRating</span><span class="p">,</span> <span class="n">ChargerError</span><span class="p">,</span> <span class="n">EventSource</span>
<span class="kn">from</span> <span class="nn">philander.configurable</span> <span class="kn">import</span> <span class="n">ConfigItem</span><span class="p">,</span> <span class="n">Configurable</span>
<span class="kn">from</span> <span class="nn">philander.gpio</span> <span class="kn">import</span> <span class="n">GPIO</span>
<span class="kn">from</span> <span class="nn">philander.imath</span> <span class="kn">import</span> <span class="n">ctz</span><span class="p">,</span> <span class="n">iprevpowtwo</span><span class="p">,</span> <span class="n">vlbs</span>
<span class="kn">from</span> <span class="nn">philander.interruptable</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Interruptable</span><span class="p">,</span> <span class="n">EventContextControl</span>
<span class="kn">from</span> <span class="nn">philander.serialbus</span> <span class="kn">import</span> <span class="n">SerialBusDevice</span>
<span class="kn">from</span> <span class="nn">philander.sysfactory</span> <span class="kn">import</span> <span class="n">SysFactory</span>
<span class="kn">from</span> <span class="nn">philander.systypes</span> <span class="kn">import</span> <span class="n">ErrorCode</span><span class="p">,</span> <span class="n">Info</span><span class="p">,</span> <span class="n">RunLevel</span>
<span class="kn">from</span> <span class="nn">philander.watchdog</span> <span class="kn">import</span> <span class="n">Watchdog</span>


<div class="viewcode-block" id="MAX77960">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960">[docs]</a>
<span class="k">class</span> <span class="nc">MAX77960</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="p">,</span> <span class="n">SerialBusDevice</span><span class="p">,</span> <span class="n">Charger</span><span class="p">,</span> <span class="n">Configurable</span><span class="p">,</span> <span class="n">Interruptable</span><span class="p">,</span> <span class="n">Watchdog</span> <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Driver implementation for the MAX77960 USB battery charger.</span>
<span class="sd">    </span>
<span class="sd">    More information on the functionality of the chip can be found at</span>
<span class="sd">    the Analog site:</span>
<span class="sd">    https://www.analog.com/en/products/max77960.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># The only address is 0x69. No alternative.</span>
    <span class="n">ADDRESSES_ALLOWED</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x69</span><span class="p">]</span>

    <span class="c1"># The watch dog time interval t(WD)as defined in the data sheet</span>
    <span class="n">WATCHDOG_INTERVAL_MS</span> <span class="o">=</span> <span class="mi">80000</span>
    
    <span class="c1"># Revision tags, as translated from chip ID</span>
    <span class="c1"># to be compared with the result of getInfo()</span>
    <span class="n">REVISION_MAJOR_5</span>    <span class="o">=</span> <span class="mi">5</span>
    <span class="n">REVISION_MAJOR_6</span>    <span class="o">=</span> <span class="mi">6</span>
    <span class="n">REVISION_MAJOR_MIN</span>  <span class="o">=</span> <span class="n">REVISION_MAJOR_5</span>
    <span class="n">REVISION_MAJOR_MAX</span>  <span class="o">=</span> <span class="n">REVISION_MAJOR_6</span>
    <span class="n">REVISION_MAJOR_MAX7796x</span> <span class="o">=</span> <span class="n">REVISION_MAJOR_5</span>
    <span class="n">REVISION_MAJOR_MAX7796xB</span><span class="o">=</span> <span class="n">REVISION_MAJOR_6</span>
    <span class="n">REVISION_MINOR_MIN</span>  <span class="o">=</span> <span class="mi">0</span>
    <span class="n">REVISION_MINOR_MAX</span>  <span class="o">=</span> <span class="mh">0x1F</span>
    
<div class="viewcode-block" id="MAX77960.getRegisterMap">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getRegisterMap">[docs]</a>
    <span class="k">def</span> <span class="nf">getRegisterMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">registerMap</span></div>

    
<div class="viewcode-block" id="MAX77960.getRegContentStr">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getRegContentStr">[docs]</a>
    <span class="k">def</span> <span class="nf">getRegContentStr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">regDescr</span><span class="p">,</span> <span class="n">content</span> <span class="p">):</span>
        <span class="n">ret</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">regDescr</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>    <span class="c1"># No description of components/bits given</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">frag</span> <span class="ow">in</span> <span class="n">regDescr</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">ctz</span><span class="p">(</span> <span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">fragVal</span> <span class="o">=</span> <span class="p">(</span><span class="n">content</span> <span class="o">&amp;</span> <span class="n">frag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">frag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fragVal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">return</span> <span class="n">ret</span></div>



<div class="viewcode-block" id="MAX77960.getAllRegistersStr">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getAllRegistersStr">[docs]</a>
    <span class="k">def</span> <span class="nf">getAllRegistersStr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">descr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">registerMap</span><span class="p">:</span>
            <span class="n">cont</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">descr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
                <span class="n">contStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRegContentStr</span><span class="p">(</span> <span class="n">descr</span><span class="p">,</span> <span class="n">cont</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">contStr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Read error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">descr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">descr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cont</span><span class="p">,</span> <span class="n">contStr</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret</span></div>


            
    <span class="c1">#</span>
    <span class="c1"># Configurable options</span>
    <span class="c1">#</span>
    
    <span class="n">CFG_COMM_MODE</span> <span class="o">=</span> <span class="s1">&#39;Charger.Comm.Mode&#39;</span>
    <span class="n">CFG_DISIBS</span> <span class="o">=</span> <span class="s1">&#39;Charger.DisIBS&#39;</span>
    <span class="n">CFG_MODE</span> <span class="o">=</span> <span class="s1">&#39;Charger.Mode&#39;</span>
    <span class="n">CFG_PQEN</span> <span class="o">=</span> <span class="s1">&#39;Charger.Prequal&#39;</span>
    <span class="n">CFG_CHG_RSTRT</span> <span class="o">=</span> <span class="s1">&#39;Charger.Restart&#39;</span>
    <span class="n">CFG_STAT_EN</span> <span class="o">=</span> <span class="s1">&#39;Charger.Stat&#39;</span>
    <span class="n">CFG_FCHGTIME</span> <span class="o">=</span> <span class="s1">&#39;Charger.Timer.FastCharge&#39;</span>
    <span class="n">CFG_CHGCC</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.FastCharge&#39;</span>
    <span class="n">CFG_TO_TIME</span> <span class="o">=</span> <span class="s1">&#39;Charger.Timer.Topoff&#39;</span>
    <span class="n">CFG_TO_ITH</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.Topoff&#39;</span>
    <span class="n">CFG_CHG_CV_PRM</span> <span class="o">=</span> <span class="s1">&#39;Charger.Voltage.ChargeTermination&#39;</span>
    <span class="n">CFG_ITRICKLE</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.Trickle&#39;</span>
    <span class="n">CFG_B2SOVRC</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.Batt2Sys&#39;</span>
    <span class="n">CFG_JEITA_EN</span> <span class="o">=</span> <span class="s1">&#39;Charger.Jeita&#39;</span>
    <span class="n">CFG_REGTEMP</span> <span class="o">=</span> <span class="s1">&#39;Charger.Temp.Reg&#39;</span>
    <span class="n">CFG_VCHGCV_COOL</span> <span class="o">=</span> <span class="s1">&#39;Charger.Voltage.Jeita.Term&#39;</span>
    <span class="n">CFG_ICHGCC_COOL</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.Jeita.FastCharge&#39;</span>
    <span class="n">CFG_CHGIN_ILIM</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.Input&#39;</span>
    <span class="n">CFG_OTG_ILIM</span> <span class="o">=</span> <span class="s1">&#39;Charger.Current.OTG&#39;</span>
    <span class="n">CFG_MINVSYS</span> <span class="o">=</span> <span class="s1">&#39;Charger.Voltage.MinVSys&#39;</span>
    <span class="n">CFG_VCHGIN_REG</span> <span class="o">=</span> <span class="s1">&#39;Charger.Voltage.ChargeIn&#39;</span>

    <span class="n">_CONFIGURABLES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># cfg string    : (register offset, register bit mask, default value) </span>
        <span class="n">CFG_COMM_MODE</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">COMM_MODE</span><span class="p">,</span>   <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">COMM_MODE_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_DISIBS</span>      <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">DISIBS</span><span class="p">,</span>      <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">DISIBS_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_MODE</span>        <span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MODE</span><span class="p">,</span>        <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MODE_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_PQEN</span>        <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">PQEN</span><span class="p">,</span>        <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">PQEN_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_CHG_RSTRT</span>   <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_RSTRT</span><span class="p">,</span>   <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_RSTRT_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_STAT_EN</span>     <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">STAT_EN</span><span class="p">,</span>     <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">STAT_EN_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_FCHGTIME</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">FCHGTIME</span><span class="p">,</span>    <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">FCHGTIME_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_CHGCC</span>       <span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGCC</span><span class="p">,</span>       <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGCC_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_TO_TIME</span>     <span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TO_TIME</span><span class="p">,</span>     <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TO_TIME_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_TO_ITH</span>      <span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TO_ITH</span><span class="p">,</span>      <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TO_ITH_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_CHG_CV_PRM</span>  <span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_CV_PRM</span><span class="p">,</span>  <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_CV_PRM_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_ITRICKLE</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">ITRICKLE</span><span class="p">,</span>    <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">ITRICKLE_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_B2SOVRC</span>     <span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">B2SOVRC</span><span class="p">,</span>     <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">B2SOVRC_DEFAULT</span><span class="p">),</span>
        <span class="c1">#skip config register 06</span>
        <span class="n">CFG_JEITA_EN</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">JEITA_EN</span><span class="p">,</span>    <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">JEITA_EN_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_REGTEMP</span>     <span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REGTEMP</span><span class="p">,</span>     <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REGTEMP_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_VCHGCV_COOL</span> <span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">VCHGCV_COOL</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">VCHGCV_COOL_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_ICHGCC_COOL</span> <span class="p">:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">ICHGCC_COOL</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">ICHGCC_COOL_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_CHGIN_ILIM</span>  <span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_ILIM</span><span class="p">,</span>  <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_ILIM_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_OTG_ILIM</span>    <span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">OTG_ILIM</span><span class="p">,</span>    <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">OTG_ILIM_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_MINVSYS</span>     <span class="p">:</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MINVSYS</span><span class="p">,</span>     <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MINVSYS_DEFAULT</span><span class="p">),</span>
        <span class="n">CFG_VCHGIN_REG</span>  <span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">VCHGIN_REG</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">VCHGIN_REG_DEFAULT</span><span class="p">),</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="c1"># Specific instance attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Call constructors of the super class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># Helper functions</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="MAX77960.checkID">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.checkID">[docs]</a>
    <span class="k">def</span> <span class="nf">checkID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads the chip ID and verifies it against the expected value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">revMajor</span> <span class="o">&lt;</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">REVISION_MAJOR_MIN</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">revMajor</span> <span class="o">&gt;</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">REVISION_MAJOR_MAX</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">revMinor</span> <span class="o">&lt;</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">REVISION_MINOR_MIN</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">revMinor</span> <span class="o">&gt;</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">REVISION_MINOR_MAX</span><span class="p">):</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errSpecRange</span>
        <span class="k">return</span> <span class="n">err</span></div>

    
    <span class="k">def</span> <span class="nf">_lockRegisters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_06</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGPROT_LOCK</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTCLR_DO_NOT_TOUCH</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unlockRegisters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_06</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGPROT_UNLOCK</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTCLR_DO_NOT_TOUCH</span> <span class="p">)</span>


    <span class="c1">#</span>
    <span class="c1"># Module API</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="MAX77960.Params_init">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.Params_init">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Params_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">paramDict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes configuration parameters with defaults.</span>
<span class="sd">        </span>
<span class="sd">        The following settings are supported:</span>
<span class="sd">        </span>
<span class="sd">        =================================    ==========================================================================================================</span>
<span class="sd">        Key name                             Value type, meaning and default</span>
<span class="sd">        =================================    ==========================================================================================================</span>
<span class="sd">        SerialBusDevice.address              ``int`` I2C serial device address; default is :attr:`ADDRESSES_ALLOWED` [0].</span>
<span class="sd">        Charger.Comm.Mode                    ``int`` Communication mode; default is :attr:`MAX77960_Reg.COMM_MODE_DEFAULT`.</span>
<span class="sd">        Charger.DisIBS                       ``int`` ; default is :attr:`MAX77960_Reg.DISIBS_DEFAULT`.</span>
<span class="sd">        Charger.Mode                         ``int`` ; default is :attr:`MAX77960_Reg.MODE_DEFAULT`.</span>
<span class="sd">        Charger.Prequal                      ``int`` ; default is :attr:`MAX77960_Reg.PQEN_DEFAULT`.</span>
<span class="sd">        Charger.Restart                      ``int`` ; default is :attr:`MAX77960_Reg.CHG_RSTRT_DEFAULT`.</span>
<span class="sd">        Charger.Stat                         ``int`` ; default is :attr:`MAX77960_Reg.STAT_EN_DEFAULT`.</span>
<span class="sd">        Charger.Timer.FastCharge             ``int`` ; default is :attr:`MAX77960_Reg.FCHGTIME_DEFAULT`.</span>
<span class="sd">        Charger.Current.FastCharge           ``int`` ; default is :attr:`MAX77960_Reg.CHGCC_DEFAULT`.</span>
<span class="sd">        Charger.Timer.Topoff                 ``int`` ; default is :attr:`MAX77960_Reg.TO_TIME_DEFAULT`.</span>
<span class="sd">        Charger.Current.Topoff               ``int`` ; default is :attr:`MAX77960_Reg.TO_ITH_DEFAULT`.</span>
<span class="sd">        Charger.Voltage.ChargeTermination    ``int`` ; default is :attr:`MAX77960_Reg.CHG_CV_PRM_DEFAULT`.</span>
<span class="sd">        Charger.Current.Trickle              ``int`` ; default is :attr:`MAX77960_Reg.ITRICKLE_DEFAULT`.</span>
<span class="sd">        Charger.Current.Batt2Sys             ``int`` ; default is :attr:`MAX77960_Reg.B2SOVRC_DEFAULT`.</span>
<span class="sd">        Charger.Jeita                        ``int`` ; default is :attr:`MAX77960_Reg.JEITA_EN_DEFAULT`.</span>
<span class="sd">        Charger.Temp.Reg                     ``int`` ; default is :attr:`MAX77960_Reg.REGTEMP_DEFAULT`.</span>
<span class="sd">        Charger.Voltage.Jeita.Term           ``int`` ; default is :attr:`MAX77960_Reg.VCHGCV_COOL_DEFAULT`.</span>
<span class="sd">        Charger.Current.Jeita.FastCharge     ``int`` ; default is :attr:`MAX77960_Reg.ICHGCC_COOL_DEFAULT`.</span>
<span class="sd">        Charger.Current.Input                ``int`` ; default is :attr:`MAX77960_Reg.CHGIN_ILIM_DEFAULT`.</span>
<span class="sd">        Charger.Current.OTG                  ``int`` ; default is :attr:`MAX77960_Reg.OTG_ILIM_DEFAULT`.</span>
<span class="sd">        Charger.Voltage.MinVSys              ``int`` ; default is :attr:`MAX77960_Reg.MINVSYS_DEFAULT`.</span>
<span class="sd">        Charger.Voltage.ChargeIn             ``int`` ; default is :attr:`MAX77960_Reg.VCHGIN_REG_DEFAULT`.</span>
<span class="sd">        All Charger.int.gpio.* settings as documented at :meth:`.GPIO.Params_init`.</span>
<span class="sd">        ===============================================================================================================================================</span>
<span class="sd">        </span>
<span class="sd">        Also see: :meth:`.Charger.Params_init`, :meth:`.SerialBusDevice.Params_init`, :meth:`.GPIO.Params_init`. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Override default base class parameter: serial bus device address</span>
        <span class="n">paramDict</span><span class="p">[</span><span class="s2">&quot;SerialBusDevice.address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ADDRESSES_ALLOWED</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Add interrupt pin /gpio specifics</span>
        <span class="n">paramDict</span><span class="p">[</span><span class="s2">&quot;Charger.int.gpio.direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">DIRECTION_IN</span>
        <span class="c1"># If not present, add settings different from hardware reset values</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Charger.Comm.Mode&quot;</span> <span class="p">:</span>           <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">COMM_MODE_I2C</span><span class="p">,</span>
            <span class="s2">&quot;Charger.int.gpio.trigger&quot;</span><span class="p">:</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">TRIGGER_EDGE_FALLING</span><span class="p">,</span>
            <span class="s2">&quot;Charger.int.gpio.bounce&quot;</span> <span class="p">:</span>    <span class="n">GPIO</span><span class="o">.</span><span class="n">BOUNCE_NONE</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">:</span>
                <span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># Add other charger configurables (defaults)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dflt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">_CONFIGURABLES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">:</span>
                <span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dflt</span>
        
        <span class="n">gpioParams</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">GPIO</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span> <span class="n">gpioParams</span> <span class="p">)</span>
        <span class="n">gp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[(</span><span class="s2">&quot;Charger.int.&quot;</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">gpioParams</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">):</span>
                <span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># Let the base class(es) do the rest</span>
        <span class="n">SerialBusDevice</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span><span class="n">paramDict</span><span class="p">)</span>
        <span class="n">Watchdog</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span><span class="n">paramDict</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="MAX77960.open">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.open">[docs]</a>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramDict</span><span class="p">):</span>
        <span class="c1"># Get default parameters</span>
        <span class="n">defParam</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">MAX77960</span><span class="o">.</span><span class="n">Params_init</span><span class="p">(</span> <span class="n">defParam</span> <span class="p">)</span>
        <span class="c1"># Open the bus device</span>
        <span class="n">paramDict</span><span class="p">[</span><span class="s2">&quot;SerialBusDevice.address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">ADDRESSES_ALLOWED</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">SerialBusDevice</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramDict</span><span class="p">)</span>
        <span class="c1"># Configure the sensor</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
            <span class="c1"># Account for defaults different from hardware-resets</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="n">MAX77960</span><span class="o">.</span><span class="n">CFG_COMM_MODE</span><span class="p">,):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">:</span>
                    <span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">defParam</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="c1"># Note that config registers #1, 2, 3, 4, 5, 7, 8, 9</span>
            <span class="c1"># are write protected (locked), while #0, 6, 10 are not.</span>
            <span class="c1"># REG_CHG_CNFG_00, 01, 02, 03, ...</span>
            <span class="n">mask</span><span class="o">=</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">regoff</span><span class="p">,</span> <span class="n">msk</span><span class="p">,</span> <span class="n">dflt</span><span class="p">)</span> <span class="ow">in</span> <span class="n">MAX77960</span><span class="o">.</span><span class="n">_CONFIGURABLES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dflt</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">paramDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="n">MAX77960</span><span class="o">.</span><span class="n">CFG_CHGIN_ILIM</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_ILIM_100</span>
                        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">6300</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_ILIM_6300</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">//</span> <span class="mi">50</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">regoff</span><span class="p">]</span> <span class="o">|=</span> <span class="n">msk</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">regoff</span><span class="p">]</span> <span class="o">|=</span> <span class="n">value</span>
        
            <span class="bp">self</span><span class="o">.</span><span class="n">_unlockRegisters</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">11</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">reg</span> <span class="o">=</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span> <span class="o">+</span> <span class="n">idx</span>
                    <span class="c1"># Copy masked bits to the register content</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">reg</span> <span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lockRegisters</span><span class="p">()</span>
        <span class="c1"># Setup interrupt related stuff.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;Charger.int.gpio.pinDesignator&quot;</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">):</span>
                <span class="n">paramDict</span><span class="p">[</span><span class="s2">&quot;Charger.int.gpio.direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">DIRECTION_IN</span>
                <span class="n">gpioParams</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[(</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Charger.int.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Charger.int.&quot;</span><span class="p">)]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span> <span class="o">=</span> <span class="n">SysFactory</span><span class="o">.</span><span class="n">getGPIO</span><span class="p">()</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">gpioParams</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enableInterrupt</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>



<div class="viewcode-block" id="MAX77960.close">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.close">[docs]</a>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.setRunLevel">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.setRunLevel">[docs]</a>
    <span class="k">def</span> <span class="nf">setRunLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">RunLevel</span><span class="o">.</span><span class="n">snooze</span><span class="p">):</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">STBY_EN</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">|=</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">STBY_EN</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


    <span class="c1">#</span>
    <span class="c1"># Charger API</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="MAX77960.reset">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span><span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_SWRST</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">SWRST_TYPE_O</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">err</span></div>


<div class="viewcode-block" id="MAX77960.getInfo">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getInfo">[docs]</a>
    <span class="k">def</span> <span class="nf">getInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">Info</span><span class="p">()</span>
        <span class="c1"># Chip ID, silicon revision and OTP recipe version</span>
        <span class="n">info</span><span class="o">.</span><span class="n">chipID</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span><span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CID</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="c1"># Get silicon revision from the same register</span>
            <span class="n">info</span><span class="o">.</span><span class="n">revMajor</span> <span class="o">=</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">chipID</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CID_REVISION</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
            <span class="n">info</span><span class="o">.</span><span class="n">revMinor</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">chipID</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CID_VERSION</span>
            <span class="n">info</span><span class="o">.</span><span class="n">validity</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">validChipID</span> \
                            <span class="o">|</span> <span class="n">info</span><span class="o">.</span><span class="n">validRevMajor</span> <span class="o">|</span> <span class="n">info</span><span class="o">.</span><span class="n">validRevMinor</span>
        <span class="k">return</span> <span class="n">info</span><span class="p">,</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.isBatteryPresent">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.isBatteryPresent">[docs]</a>
    <span class="k">def</span> <span class="nf">isBatteryPresent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_REMOVAL</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errUnavailable</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errUnavailable</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errMalfunction</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.getNumCells">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getNumCells">[docs]</a>
    <span class="k">def</span> <span class="nf">getNumCells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_02</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">NUM_CELL_DTLS</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">NUM_CELL_DTLS_3</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.getBatStatus">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getBatStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getBatStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS</span>
            <span class="k">if</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_REMOVAL</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">removed</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_BELOW_PREQ</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">empty</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_TIME_OUT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">broken</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_OK</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">normal</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_LOW_VOLT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">low</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_OVR_VOLT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">overvoltage</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_OVR_CURR</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">BatStatus</span><span class="o">.</span><span class="n">overcurrent</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.getChgStatus">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getChgStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getChgStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS</span>
            <span class="k">if</span> <span class="n">cd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_PRECHRG</span><span class="p">:</span>
                <span class="n">bd</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS</span>
                <span class="k">if</span> <span class="n">bd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_DTLS_BELOW_PREQ</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">preCharge</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">trickle</span>
            <span class="k">elif</span> <span class="n">cd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_FAST_CURR</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">fastChargeConstCurrent</span>
            <span class="k">elif</span> <span class="n">cd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_FAST_VOLT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">fastChargeConstVoltage</span>
            <span class="k">elif</span> <span class="n">cd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_TOP_OFF</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">topOff</span>
            <span class="k">elif</span> <span class="n">cd</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_DONE</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">done</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChgStatus</span><span class="o">.</span><span class="n">off</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.getDCStatus">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getDCStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getDCStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_00</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS</span>
            <span class="k">if</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_GOOD</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">valid</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_TOO_LOW</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">undervoltage</span>
            <span class="k">elif</span> <span class="n">ds</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_TOO_HIGH</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">DCStatus</span><span class="o">.</span><span class="n">overvoltage</span>
        <span class="k">return</span> <span class="n">ret</span></div>

      
<div class="viewcode-block" id="MAX77960.getPowerSrc">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getPowerSrc">[docs]</a>
    <span class="k">def</span> <span class="nf">getPowerSrc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_00</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">chgin</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS</span>
            <span class="n">qbat</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">QB_DTLS</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">chgin</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_GOOD</span><span class="p">):</span>
                <span class="c1"># Valid CHGIN, so external power is the primary source</span>
                <span class="n">ret</span> <span class="o">|=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">dc</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">qbat</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">QB_DTLS_ON</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">|=</span> <span class="n">PowerSrc</span><span class="o">.</span><span class="n">bat</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.getChargerTempStatus">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getChargerTempStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getChargerTempStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">chg</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS</span>
            <span class="k">if</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_TEMP</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">hot</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">treg</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TREG</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">treg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TREG_HIGH</span><span class="p">):</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">warm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">ok</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.getBatteryTempStatus">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getBatteryTempStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getBatteryTempStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_02</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">thm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS</span>
            <span class="k">if</span> <span class="n">thm</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS_COLD</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">cold</span>
            <span class="k">elif</span> <span class="n">thm</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS_COOL</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">cool</span>
            <span class="k">elif</span> <span class="n">thm</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS_NORMAL</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">ok</span>
            <span class="k">elif</span> <span class="n">thm</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS_WARM</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">warm</span>
            <span class="k">elif</span> <span class="n">thm</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">THM_DTLS_HOT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">hot</span>
            <span class="k">else</span><span class="p">:</span>   <span class="c1"># Battery removed or temperature monitoring disabled.</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">TemperatureRating</span><span class="o">.</span><span class="n">unknown</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.getError">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getError">[docs]</a>
    <span class="k">def</span> <span class="nf">getError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">unknown</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">chg</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS</span>
            <span class="k">if</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_RESIST</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">config</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_E_TIMER</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">timer</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_SUSP_QBAT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">batBroken</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_CHGIN</span><span class="p">:</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_00</span> <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
                    <span class="n">chgin</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS</span>
                    <span class="k">if</span> <span class="n">chgin</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_TOO_HIGH</span><span class="p">:</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">dcHigh</span>
                    <span class="k">elif</span> <span class="n">chgin</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_DTLS_TOO_LOW</span><span class="p">:</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">dcLow</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">dc</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_TEMP</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">tempChg</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_WDOG</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">config</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_SUSP_JEITA</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">tempBat</span>
            <span class="k">elif</span> <span class="n">chg</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_SUSP_NOBAT</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">batRemoved</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ChargerError</span><span class="o">.</span><span class="n">ok</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.restartCharging">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.restartCharging">[docs]</a>
    <span class="k">def</span> <span class="nf">restartCharging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># To recover from timer fault, switch charger off...</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">COMM_MODE_I2C</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">DISIBS_FET_PPSM</span> <span class="o">|</span> \
               <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">STBY_EN_DCDC_PPSM</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTEN_OFF</span> 
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span>
                                      <span class="n">data</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MODE_DCDC_ONLY</span> <span class="p">)</span>
        <span class="c1"># ... and on again.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span>
                                          <span class="n">data</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">MODE_CHRG_DCDC</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


    <span class="c1">#</span>
    <span class="c1"># Interruptable API</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="MAX77960.registerInterruptHandler">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.registerInterruptHandler">[docs]</a>
    <span class="k">def</span> <span class="nf">registerInterruptHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callerFeedBack</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">onEvent</span> <span class="o">==</span> <span class="n">Event</span><span class="o">.</span><span class="n">evtInt1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">onEvent</span> <span class="o">==</span> <span class="n">Event</span><span class="o">.</span><span class="n">evtAny</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinInt</span><span class="o">.</span><span class="n">registerInterruptHandler</span><span class="p">(</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">EVENT_DEFAULT</span><span class="p">,</span> <span class="n">callerFeedBack</span><span class="p">,</span> <span class="n">handler</span> <span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableInterrupt</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errExhausted</span>
        <span class="k">return</span> <span class="n">ret</span></div>

        
    <span class="k">def</span> <span class="nf">_mapIntApi2Impl</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">apiMask</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps API :class:`.charger.EventSource` to the \</span>
<span class="sd">        implementation-level interrupts as follows:</span>
<span class="sd">        </span>
<span class="sd">            REG_TOP_INT: :attr:`.MAX7760._TSHDN_I`      &lt;-&gt; :attr:`.charger.EventSource.thermalShutdown`</span>
<span class="sd">            REG_TOP_INT: :attr:`.MAX7760._SYSOVLO_I`    &lt;-&gt; :attr:`.charger.EventSource.systemOvervoltage`</span>
<span class="sd">            REG_TOP_INT: :attr:`.MAX7760._SYSUVLO_I`    &lt;-&gt; :attr:`.charger.EventSource.systemUndervoltage`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._AICL_I`       &lt;-&gt; :attr:`.charger.EventSource.inputCurrentLimitSrc`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._CHGIN_I`      &lt;-&gt; :attr:`.charger.EventSource.inputVoltage`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._B2SOVRC_I`    &lt;-&gt; :attr:`.charger.EventSource.batteryOvercurrent`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._CHG_I`        &lt;-&gt; :attr:`.charger.EventSource.chargingPhase`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._BAT_I`        &lt;-&gt; :attr:`.charger.EventSource.batteryTemperature`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._CHGINLIM_I`   &lt;-&gt; :attr:`.charger.EventSource.inputCurrentLimitOwn`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._DISQBAT_I`    &lt;-&gt; :attr:`.charger.EventSource.onOff`</span>
<span class="sd">            REG_CHG_INT: :attr:`.MAX7760._OTG_PLIM_I`   &lt;-&gt; :attr:`.charger.EventSource.internal`</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topMask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chgMask</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">thermalShutdown</span><span class="p">):</span>
            <span class="n">topMask</span> <span class="o">=</span> <span class="n">topMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TSHDN_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">systemOvervoltage</span><span class="p">):</span>
            <span class="n">topMask</span> <span class="o">=</span> <span class="n">topMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">SYSOVLO_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">systemUndervoltage</span><span class="p">):</span>
            <span class="n">topMask</span> <span class="o">=</span> <span class="n">topMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">SYSUVLO_M</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputCurrentLimitSrc</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">AICL_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputVoltage</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">batteryOvercurrent</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">B2SOVRC_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">chargingPhase</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">batteryTemperature</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputCurrentLimitOwn</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGINLIM_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">onOff</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">DISQBAT_M</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">apiMask</span> <span class="o">&amp;</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">internal</span><span class="p">):</span>
            <span class="n">chgMask</span> <span class="o">=</span> <span class="n">chgMask</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">OTG_PLIM_M</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">topMask</span><span class="p">,</span> <span class="n">chgMask</span><span class="p">]</span>
            
        
    <span class="k">def</span> <span class="nf">_mapIntImpl2Api</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">topMask</span><span class="p">,</span> <span class="n">chgMask</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps implementation-level interrupts to API event sources.</span>
<span class="sd">        </span>
<span class="sd">        For the detailed mapping, see :meth:`_mapIntApi2Impl`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intMask</span> <span class="o">=</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">none</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">TSHDN_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">thermalShutdown</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">SYSOVLO_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">systemOvervoltage</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">topMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">SYSUVLO_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">systemUndervoltage</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">AICL_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputCurrentLimitSrc</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGIN_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputVoltage</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">B2SOVRC_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">batteryOvercurrent</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">chargingPhase</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">BAT_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">batteryTemperature</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHGINLIM_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">inputCurrentLimitOwn</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">DISQBAT_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">onOff</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chgMask</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">OTG_PLIM_M</span><span class="p">):</span>
            <span class="n">intMask</span> <span class="o">=</span> <span class="n">intMask</span> <span class="o">|</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">internal</span>
        <span class="k">return</span> <span class="n">intMask</span>

<div class="viewcode-block" id="MAX77960.enableInterrupt">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.enableInterrupt">[docs]</a>
    <span class="k">def</span> <span class="nf">enableInterrupt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span></div>


<div class="viewcode-block" id="MAX77960.disableInterrupt">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.disableInterrupt">[docs]</a>
    <span class="k">def</span> <span class="nf">disableInterrupt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span></div>


<div class="viewcode-block" id="MAX77960.getEventContext">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.getEventContext">[docs]</a>
    <span class="k">def</span> <span class="nf">getEventContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve more detailed information on an event.</span>
<span class="sd">        </span>
<span class="sd">        The ``event`` parameter should be :attr:`.interruptable.Event.evtInt1`,</span>
<span class="sd">        as there is only this one interrupt line.</span>
<span class="sd">        On return, the ``context`` parameter carries the resulting</span>
<span class="sd">        information. It must be an instance of :class:`.charger.EventContext`,</span>
<span class="sd">        which is semantically multiplexed by its :attr:`.charger.EventContext.source`</span>
<span class="sd">        attribute. </span>
<span class="sd">        </span>
<span class="sd">        Also see: :meth:`.Interruptable.getEventContext`.</span>

<span class="sd">        :param int event: The original event occurred.</span>
<span class="sd">        :param .charger.EventContext context: Context information. </span>
<span class="sd">        :return: An error code indicating either success or the reason of failure.</span>
<span class="sd">        :rtype: ErrorCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errInvalidParameter</span>
        <span class="k">elif</span><span class="p">(</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAttached</span><span class="p">()</span> <span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errResourceConflict</span>
        <span class="k">elif</span><span class="p">(</span> <span class="n">event</span> <span class="o">==</span> <span class="n">Event</span><span class="o">.</span><span class="n">evtNone</span> <span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errFewData</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">event</span> <span class="o">==</span> <span class="n">Event</span><span class="o">.</span><span class="n">evtInt1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">event</span> <span class="o">==</span> <span class="n">Event</span><span class="o">.</span><span class="n">evtAny</span><span class="p">)):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
            <span class="c1"># Retrieving the interrupt status resets all bits in these registers!</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">==</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">clearAll</span> <span class="p">):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_TOP_INT</span> <span class="p">)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_INT</span> <span class="p">)</span>
                <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">context</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">EventSource</span><span class="o">.</span><span class="n">none</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">==</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">getFirst</span><span class="p">):</span>
                    <span class="n">topStatus</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_TOP_INT</span> <span class="p">)</span>
                    <span class="n">chgStatus</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_INT</span> <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapIntImpl2Api</span><span class="p">(</span> <span class="n">topStatus</span><span class="p">,</span> <span class="n">chgStatus</span> <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">getNext</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">==</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">getLast</span><span class="p">):</span>
                    <span class="n">topStatus</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_TOP_INT</span> <span class="p">)</span>
                    <span class="n">chgStatus</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_INT</span> <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapIntImpl2Api</span><span class="p">(</span> <span class="n">topStatus</span><span class="p">,</span> <span class="n">chgStatus</span> <span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">getPrevious</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errFewData</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">control</span> <span class="o">==</span> <span class="n">EventContextControl</span><span class="o">.</span><span class="n">getNext</span><span class="p">):</span>
                            <span class="c1"># Find value of highest bit:</span>
                            <span class="n">context</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">iprevpowtwo</span><span class="p">(</span> <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Find (value of) least bit set:</span>
                            <span class="n">context</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">vlbs</span><span class="p">(</span> <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="p">)</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">context</span><span class="o">.</span><span class="n">source</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">remainInt</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
                            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errMoreData</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errInvalidParameter</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
    <span class="c1">#</span>
    <span class="c1"># Configurable API</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="MAX77960.configure">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.configure">[docs]</a>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configData</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errNotSupported</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">configData</span><span class="o">.</span><span class="n">item</span> <span class="o">==</span> <span class="n">ConfigItem</span><span class="o">.</span><span class="n">eventArm</span><span class="p">):</span>
            <span class="c1"># Clear current interrupts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_TOP_INT</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_INT</span> <span class="p">)</span>
            <span class="c1"># Un-mask specified interrupts</span>
            <span class="p">[</span><span class="n">topMask</span><span class="p">,</span> <span class="n">chgMask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapIntApi2Impl</span><span class="p">(</span><span class="n">configData</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_TOP_INT_MASK</span><span class="p">,</span> <span class="o">~</span><span class="n">topMask</span> <span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_INT_MASK</span><span class="p">,</span> <span class="o">~</span><span class="n">chgMask</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
    
    <span class="c1">#</span>
    <span class="c1"># The Watchdog API</span>
    <span class="c1">#</span>
    
<div class="viewcode-block" id="MAX77960.enableWatchdog">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.enableWatchdog">[docs]</a>
    <span class="k">def</span> <span class="nf">enableWatchdog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableReg</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTEN</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.disableWatchdog">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.disableWatchdog">[docs]</a>
    <span class="k">def</span> <span class="nf">disableWatchdog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disableReg</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span><span class="p">,</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTEN</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    
<div class="viewcode-block" id="MAX77960.isWatchdogRunning">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.isWatchdogRunning">[docs]</a>
    <span class="k">def</span> <span class="nf">isWatchdogRunning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_00</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTEN</span><span class="p">)</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTEN_ON</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errUnavailable</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.clearWatchdog">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.clearWatchdog">[docs]</a>
    <span class="k">def</span> <span class="nf">clearWatchdog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_06</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTCLR</span><span class="p">)</span> <span class="o">|</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">WDTCLR_DO_CLEAR</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_CNFG_06</span><span class="p">,</span> <span class="n">data</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.isWatchdogElapsed">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.isWatchdogElapsed">[docs]</a>
    <span class="k">def</span> <span class="nf">isWatchdogElapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readByteRegister</span><span class="p">(</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">REG_CHG_DETAILS_01</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">isOk</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS</span><span class="p">)</span> <span class="o">==</span> <span class="n">MAX77960_Reg</span><span class="o">.</span><span class="n">CHG_DTLS_OFF_WDOG</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errOk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">errUnavailable</span>
        <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="MAX77960.clearWatchdogElapsed">
<a class="viewcode-back" href="../../philander.html#philander.max77960.MAX77960.clearWatchdogElapsed">[docs]</a>
    <span class="k">def</span> <span class="nf">clearWatchdogElapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Restart the charger by clearing the WD flag.</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clearWatchdog</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">philander</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">philander</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2024, Oliver Maye.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>