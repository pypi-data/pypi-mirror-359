<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Boot modes: network boot and hybrid boot &mdash; WalT 10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/logo-walt.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=864e5427"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer documentation summary" href="developer.html" />
    <link rel="prev" title="Node bootup procedure" href="node-bootup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: gray" >

          
          
          <a href="index.html" class="icon icon-home">
            WalT
              <img src="_static/logo-walt.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Admin / Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Admin documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-install.html">WalT server installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-upgrade.html">WalT server upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-network-config.html">WalT server-side network configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-install.html">WalT node installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch-install.html">Switch installation in WalT network</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-install.html">WalT client software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">WalT network structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="registries.html">WalT image registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">User Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="shells.html">Shell usage notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using nodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="node-ownership.html">Node ownership</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-reboot.html">Rebooting WalT nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-config.html">Updating configuration settings about nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-console.html">Connecting to a node’s serial console</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-cp.html">Transfering files to or from a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-save.html">Saving the current OS state of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-expose.html">Exposing the TCP port of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-netsetup.html">Changing network mode for a WalT node</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-networks.html">Configuring secondary networks on virtual nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-disks.html">Configuring disks on virtual nodes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using images</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image-build.html">Building a WalT image from a Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-cp.html">Transfering files to or from a walt image</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-spec-file.html">Writting image spec files</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-from-scratch.html">Creating a WalT image from scratch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="device-sets.html">Device and node sets: use several devices at once</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-config.html">Updating configuration settings about devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-port-config.html">Viewing and updating switch ports configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-expose.html">Exposing the TCP port of a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-netsetup.html">Changing network mode of a WalT node or device</a></li>
<li class="toctree-l1"><a class="reference internal" href="unmanaged-devices.html">Managing devices which do not implement WalT network booting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recording logs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="logging.html">How to use WalT logging system</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-show.html">How to query &amp; display experiment logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-wait.html">Synchronizing a script based on expected logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-checkpoint.html">Log checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-history.html">Displaying past logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-realtime.html">Displaying logs in realtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-issuers.html">Selecting log issuers</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-format.html">Adapting log display format</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-echo.html"><code class="docutils literal notranslate"><span class="pre">walt-log-echo</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-cat.html"><code class="docutils literal notranslate"><span class="pre">walt-log-cat</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-tee.html"><code class="docutils literal notranslate"><span class="pre">walt-log-tee</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-monitor.html"><code class="docutils literal notranslate"><span class="pre">walt-log-monitor</span></code> logging tool</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scripting.html">Scripting WalT experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-nodes.html">scripting API: node management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-images.html">scripting API: image management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-logs.html">scripting API: logs management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-tools.html">scripting API: miscellaneous tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="web-server.html">Web server</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-api.html">Using the web API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VPN / distant nodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vpn.html">How to use WalT built-in VPN and distant nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-security.html">WalT VPN Security notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-http-entrypoint.html">How to setup a WalT VPN HTTP entrypoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-ssh-entrypoint.html">How to setup a WalT VPN SSH entrypoint</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How it works</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="node-bootup.html">Node bootup procedure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Boot modes: network boot and hybrid boot</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network-boot-mode">Network boot mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hybrid-boot-mode">Hybrid boot mode</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-walt-python-packages.html">Repository: walt-python-packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-client.html">Repository: walt-python-packages; walt-client code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server.html">Repository: walt-python-packages; walt-server code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server-db.html">WalT server database</a></li>
<li class="toctree-l1"><a class="reference internal" href="trackexec.html">Repository: walt-python-packages; trackexec tooling.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design-notes.html">Scope and design notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional-features.html">Optional features of a WalT platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="shell-completion.html">Shell completion setup (bash and zsh)</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Compatibility notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="new-node-support.html">Adding support for a new node in WalT</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi-serial.html">Using the serial port of a Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="g5k.html">Deploying WalT on Grid’5000</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: gray" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">WalT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Boot modes: network boot and hybrid boot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="boot-modes-network-boot-and-hybrid-boot">
<h1>Boot modes: network boot and hybrid boot<a class="headerlink" href="#boot-modes-network-boot-and-hybrid-boot" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p><strong>In its default mode of operation, WalT nodes boot over the network.</strong>
This has several pros, described below. However, for some experiments,
this mode may not be applicable. In this case, users can fallback to one
of the hybrid boot variants.</p>
</section>
<section id="network-boot-mode">
<h2>Network boot mode<a class="headerlink" href="#network-boot-mode" title="Link to this heading"></a></h2>
<p>In a network booting scenario, the OS is stored on a remote server and
is never transfered as a whole to the node(s). Instead, the node sends
network requests to the server each time it needs to access a file or
directory. In a sense, compared to booting on a local disk, network
booting just means using the network controller to read OS files and
metadata instead of the disk controller.</p>
<p>In the case of a WalT node, the remote WalT image files and metadata are
accessed in read-only mode. In its bootup procedure, the node stacks on
top of this remote layer an “overlay” layer implementing copy-on-write
semantics and using the RAM for storing modifications. This allows the
OS (or the WalT user) to create, modify or delete files even if the
remote OS image is accessed in read-only mode.</p>
<p>This setup has the following pros:</p>
<ul class="simple">
<li><p><strong>Near-zero OS deployment delay.</strong> Instead of transfering a whole
image OS from the server to the node’s disk, as most other platforms
do, the server just updates a symlink to target the proper OS image
and reboots the node. One could argue that network transfers happen
once the node is booting instead, but the method remains very frugal
on network resources: only the files and metadata that are actually
necessary are transferred, which is typically less than 10% of the
total OS image size.</p></li>
<li><p><strong>Reproducibility ensured at each reboot.</strong> Since the modifications
are stored using an overlay in RAM, they are cleared when the node
reboot, and the node restarts using exactly the same OS files, i.e.,
those of the read-only remote WalT image.</p></li>
<li><p><strong>Reduced platform maintenance burden.</strong> The local disks or SD cards
of the nodes are usually the most fragile components of a platform,
so avoiding their use is preferable.</p></li>
</ul>
<p>In order to avoid exhausting the RAM space with created and modified
files, WalT nodes also mount a <strong>special memory swap device</strong> at bootup
if the WalT OS image supports it (recent debian-based images do). It is
based on <code class="docutils literal notranslate"><span class="pre">/dev/nbd0</span></code>, a “Network Block Device”, so if the node starts
swapping, data will actually be stored in a temporary file on the WalT
server.</p>
<p>However, please note that swapping can reduce the reproducibility of an
experiment and might cause OS issues in extreme situations. So you
should avoid getting to this situation by following these tips:</p>
<ul class="simple">
<li><p><strong>Heavy operations on files should be prepared in the walt images</strong>,
not run on the nodes. You can use <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">image</span> <span class="pre">shell</span></code> or
<code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">image</span> <span class="pre">build</span></code> to prepare the OS images with those heavy
operations (such as the installation of OS packages). If a part of
your setup procedure uses <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">node</span> <span class="pre">save</span></code>, it should be called
with an image where those preliminary steps have already been
applied.</p></li>
<li><p><strong>Large experiment result files should be generated in the directory
``/persist`` of the node</strong>. This directory is excluded from the RAM
overlay setup; instead, it is a read-write NFS share, so files stored
there are actually stored on the server, and they are preserved
accross node reboots.</p></li>
</ul>
<p>Sometimes, one may use the local disk(s) of a node as storage for a part
of the experiment, and let the network boot mode manage the OS files. It
is easy to add local disks to virtual nodes (see
<a class="reference internal" href="vnode-disks.html"><span class="doc">walt help show vnode-disks</span></a> for more info).</p>
<p>However, having the OS stored remotely may not match every possible
experiment. The alternate mode described below was designed to overcome
this limitation.</p>
</section>
<section id="hybrid-boot-mode">
<h2>Hybrid boot mode<a class="headerlink" href="#hybrid-boot-mode" title="Link to this heading"></a></h2>
<p>The hybrid boot mode allows to let the node copy the image contents on
its local storage and then boot from it.</p>
<p>Whatever the boot mode, the procedure is always network-based at first
(i.e. targetting the proper WalT OS image, and then downloading and
running the kernel this image contains). But then, walt-init scripts
look for local disks (or SD cards) and ext4-formatted partitions. If a
directory named <code class="docutils literal notranslate"><span class="pre">walt-hybrid</span></code> is found in the root directory of one of
these partitions, the hybrid boot mode is enabled. Otherwise, the
network boot mode continues.</p>
<p>Two hybrid mode variants exist: <strong>volatile</strong> and <strong>persistent</strong>.</p>
<p>Similarly to the network boot, the <strong>volatile</strong> variant properly ensures
reproducibility at each reboot. The copy of image contents on the local
disk is kept read-only and another sub-directory (of the same disk) is
used as a read-write overlay. This overlay directory is reset at each
bootup, which leads to a clean boot, free of any artefact from the
previous runs, and using only the WalT image contents at first.</p>
<p>The <strong>persistent</strong> variant behaves differently: all file modifications
are preserved accross reboots. Thus reproducibility at each reboot is
<strong>not</strong> ensured in this case.</p>
<p>One can activate the <strong>volatile</strong> hybrid boot on a physical node by
creating a directory named <code class="docutils literal notranslate"><span class="pre">walt-hybrid</span></code> at the root of an ext4
partition, on a local disk (or SD card) of the node. If an empty file
named <code class="docutils literal notranslate"><span class="pre">.persistent</span></code> is created in this directory <code class="docutils literal notranslate"><span class="pre">walt-hybrid</span></code>, the
boot method switches to the <strong>persistent</strong> variant.</p>
<p>Using virtual nodes, one just has to select the appropriate template
when adding the disk. (See
<a class="reference internal" href="vnode-disks.html"><span class="doc">walt help show vnode-disks</span></a> for more info.)</p>
<p>Important notes:</p>
<ul class="simple">
<li><p>The first time a node boots an image in hybrid mode, the bootup time
will be longer (up to several minutes longer, depending on network,
disk, and image size) because of the complete copy of the WalT image
to the local disk.</p></li>
<li><p>The default partitionning of SD cards usually involves a single FAT32
partition. Activating the hybrid mode in this case involves reducing
the size of this FAT32 partition, creating a second partition in the
new space, formatting this second partition using an ext4 filesystem,
and creating the <code class="docutils literal notranslate"><span class="pre">walt-hybrid</span></code> directory.</p></li>
<li><p>Frequent writes of large OS images can reduce the lifetime of the
local storage (this is especially true for non-industrial-grade SD
cards!).</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="node-bootup.html" class="btn btn-neutral float-left" title="Node bootup procedure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="developer.html" class="btn btn-neutral float-right" title="Developer documentation summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Members of the WALT project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>