<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding support for a new node in WalT &mdash; WalT 10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/logo-walt.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=864e5427"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Packaging notes" href="packaging.html" />
    <link rel="prev" title="Compatibility notes" href="compatibility.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: gray" >

          
          
          <a href="index.html" class="icon icon-home">
            WalT
              <img src="_static/logo-walt.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Admin / Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Admin documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-install.html">WalT server installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-upgrade.html">WalT server upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-network-config.html">WalT server-side network configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-install.html">WalT node installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch-install.html">Switch installation in WalT network</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-install.html">WalT client software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">WalT network structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="registries.html">WalT image registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">User Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="shells.html">Shell usage notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using nodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="node-ownership.html">Node ownership</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-reboot.html">Rebooting WalT nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-config.html">Updating configuration settings about nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-console.html">Connecting to a node’s serial console</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-cp.html">Transfering files to or from a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-save.html">Saving the current OS state of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-expose.html">Exposing the TCP port of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-netsetup.html">Changing network mode for a WalT node</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-networks.html">Configuring secondary networks on virtual nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-disks.html">Configuring disks on virtual nodes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using images</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image-build.html">Building a WalT image from a Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-cp.html">Transfering files to or from a walt image</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-spec-file.html">Writting image spec files</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-from-scratch.html">Creating a WalT image from scratch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="device-sets.html">Device and node sets: use several devices at once</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-config.html">Updating configuration settings about devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-port-config.html">Viewing and updating switch ports configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-expose.html">Exposing the TCP port of a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-netsetup.html">Changing network mode of a WalT node or device</a></li>
<li class="toctree-l1"><a class="reference internal" href="unmanaged-devices.html">Managing devices which do not implement WalT network booting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recording logs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="logging.html">How to use WalT logging system</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-show.html">How to query &amp; display experiment logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-wait.html">Synchronizing a script based on expected logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-checkpoint.html">Log checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-history.html">Displaying past logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-realtime.html">Displaying logs in realtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-issuers.html">Selecting log issuers</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-format.html">Adapting log display format</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-echo.html"><code class="docutils literal notranslate"><span class="pre">walt-log-echo</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-cat.html"><code class="docutils literal notranslate"><span class="pre">walt-log-cat</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-tee.html"><code class="docutils literal notranslate"><span class="pre">walt-log-tee</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-monitor.html"><code class="docutils literal notranslate"><span class="pre">walt-log-monitor</span></code> logging tool</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scripting.html">Scripting WalT experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-nodes.html">scripting API: node management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-images.html">scripting API: image management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-logs.html">scripting API: logs management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-tools.html">scripting API: miscellaneous tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="web-server.html">Web server</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-api.html">Using the web API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VPN / distant nodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vpn.html">How to use WalT built-in VPN and distant nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-security.html">WalT VPN Security notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-http-entrypoint.html">How to setup a WalT VPN HTTP entrypoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-ssh-entrypoint.html">How to setup a WalT VPN SSH entrypoint</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How it works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="node-bootup.html">Node bootup procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot-modes.html">Boot modes: network boot and hybrid boot</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-walt-python-packages.html">Repository: walt-python-packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-client.html">Repository: walt-python-packages; walt-client code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server.html">Repository: walt-python-packages; walt-server code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server-db.html">WalT server database</a></li>
<li class="toctree-l1"><a class="reference internal" href="trackexec.html">Repository: walt-python-packages; trackexec tooling.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="design-notes.html">Scope and design notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional-features.html">Optional features of a WalT platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="shell-completion.html">Shell completion setup (bash and zsh)</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Compatibility notes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding support for a new node in WalT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network-bootloader">Network bootloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#default-walt-image">Default walt image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi-serial.html">Using the serial port of a Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="g5k.html">Deploying WalT on Grid’5000</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: gray" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">WalT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Adding support for a new node in WalT</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-support-for-a-new-node-in-walt">
<h1>Adding support for a new node in WalT<a class="headerlink" href="#adding-support-for-a-new-node-in-walt" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>WalT is currently provided with support for several kinds of nodes:</p>
<ul class="simple">
<li><p>Raspberry Pi boards: models B, B+, 2B, 3B, 3B+ and 4B</p></li>
<li><p>Google Coral dev boards</p></li>
<li><p>Standard PC machines (x86 32bit or 64bit CPU)</p></li>
<li><p>Virtual nodes</p></li>
</ul>
<p>Check-out <a class="reference internal" href="node-install.html"><span class="doc">walt help show node-install</span></a> for more
info.</p>
<p>But WalT can also support any other kind of hardware, without having to
update its internal source code. This page explains how this can be
done.</p>
</section>
<section id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Link to this heading"></a></h2>
<p>First, you should open an issue at
<a class="reference external" href="https://github.com/drakkar-lig/walt-python-packages/issues">https://github.com/drakkar-lig/walt-python-packages/issues</a> in order to
let us assist you in this process.</p>
<p>On the technical side, support for a new kind of node in WalT requires:</p>
<ul class="simple">
<li><p>A network bootloader with appropriate configuration</p></li>
<li><p>A default walt image that will be assigned to newly detected nodes of
this kind</p></li>
</ul>
<p>In the meantime, or if this process proves impossible to achieve (e.g.,
there is no way to flash a network bootloader on this device), the WalT
platform can still provide a limited set of useful features to interact
with unmanaged devices (cf.
<a class="reference internal" href="unmanaged-devices.html"><span class="doc">walt help show unmanaged-devices</span></a>).</p>
</section>
<section id="network-bootloader">
<h2>Network bootloader<a class="headerlink" href="#network-bootloader" title="Link to this heading"></a></h2>
<p>First, you may clone git repository
<a class="reference external" href="https://github.com/drakkar-lig/walt-node-boot">https://github.com/drakkar-lig/walt-node-boot</a>. This repository currently
allows to generate SD card content of walt raspberry pi nodes, and USB
device image of walt PC nodes. It can be a good starting point. Feel
free to issue a pull request if you want your work on this repository to
be included.</p>
<p>Currently, Raspberry pi nodes use U-Boot network bootloader. And PC
nodes use iPXE network bootloader.</p>
<p>U-boot supports many single board computers, so you can probably use it
for the new board. However, check that u-Boot can handle the embedded
network adapter, it may not be the case. Support for newest boards may
be limited at first, but usually improves over time.</p>
<p>In order to work properly, the bootloader should be configured to do the
following on boot:</p>
<ol class="arabic simple">
<li><p>If handling several sub-models (such as the bootloader configuration
we provide for raspberry pi boards), identify the sub-model of the
board currently booting (e.g. <code class="docutils literal notranslate"><span class="pre">rpi-2-b</span></code>).</p></li>
<li><p>Perform a DHCP request. Important: the vendor class identifier (VCI)
of the DHCP request must be set to <code class="docutils literal notranslate"><span class="pre">walt.node.&lt;type&gt;</span></code> (e.g.
<code class="docutils literal notranslate"><span class="pre">walt.node.rpi-2-b</span></code>). This allows walt server to associate the
default walt image appropriate for this type, on fist boot. Note that
it is possible to set the UCI (User class identifier) to this value,
instead of the VCI, if setting the VCI is not possible on this
specific bootloader.</p></li>
<li><p>Download script file <code class="docutils literal notranslate"><span class="pre">start.uboot</span></code> using TFTP. On server side, this
request will be redirected to file
<code class="docutils literal notranslate"><span class="pre">[image]:/boot/&lt;node-type&gt;/start.uboot</span></code>.</p></li>
<li><p>Execute this script.</p></li>
</ol>
<p>The script <code class="docutils literal notranslate"><span class="pre">rpi/builder_files/boot.scr.txt</span></code> in <code class="docutils literal notranslate"><span class="pre">walt-node-boot</span></code>
repository is an example of a u-boot script which follows these steps.</p>
</section>
<section id="default-walt-image">
<h2>Default walt image<a class="headerlink" href="#default-walt-image" title="Link to this heading"></a></h2>
<p>In order to create a default walt image appropriate for this board, you
should check out
<a class="reference internal" href="image-from-scratch.html"><span class="doc">walt help show image-from-scratch</span></a>.</p>
<p>As an example, the default images we provide are generated by the
repository at: <a class="reference external" href="https://github.com/drakkar-lig/walt-images">https://github.com/drakkar-lig/walt-images</a>.</p>
<p>In order to let walt use your image as the default for this node type,
you must import it in walt own repository and rename it to
<code class="docutils literal notranslate"><span class="pre">waltplatform/&lt;node-type&gt;-default:latest</span></code>. For this, run the following
as root on the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ podman pull docker-daemon:&lt;docker-image&gt;:&lt;tag&gt;
$ podman tag docker.io/&lt;docker-image&gt;:&lt;tag&gt; docker.io/waltplatform/&lt;node-type&gt;-default:latest
</pre></div>
</div>
<p>Then you should let walt server daemon rescan its repository. Flag
<code class="docutils literal notranslate"><span class="pre">--refresh</span></code> of command <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">image</span> <span class="pre">show</span></code> will cause this rescan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ walt image show --refresh
</pre></div>
</div>
<p>You can now try to boot the new node for the first time.</p>
<p>After this initial try, you can of course clone this default image to
get your own copy, update it using <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">image</span> <span class="pre">shell</span></code> for instance,
and use <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">node</span> <span class="pre">boot</span></code> to test your modifications. This will make
debugging easier than having to refresh the default image again.</p>
<p>As an alternative, you can also use docker rather than walt to make
modifications, and then force walt to clone the updated default image
from the docker repository by using
<code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">advanced</span> <span class="pre">update-default-images</span></code>.</p>
<p>At the end of the debugging, in order to have your new default walt
image pushed to the docker hub, you should notify us about it (add a
comment to the issue you initially reported), and we will do it for you
(since push authorization on <code class="docutils literal notranslate"><span class="pre">waltplatform</span></code> account is restricted).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="compatibility.html" class="btn btn-neutral float-left" title="Compatibility notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="packaging.html" class="btn btn-neutral float-right" title="Packaging notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Members of the WALT project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>