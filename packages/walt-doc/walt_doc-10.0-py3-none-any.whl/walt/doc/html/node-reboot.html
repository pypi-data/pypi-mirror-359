<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rebooting WalT nodes &mdash; WalT 10.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/logo-walt.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=864e5427"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Updating configuration settings about nodes" href="node-config.html" />
    <link rel="prev" title="Node ownership" href="node-ownership.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: gray" >

          
          
          <a href="index.html" class="icon icon-home">
            WalT
              <img src="_static/logo-walt.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Admin / Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Admin documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-install.html">WalT server installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-upgrade.html">WalT server upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-network-config.html">WalT server-side network configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-install.html">WalT node installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch-install.html">Switch installation in WalT network</a></li>
<li class="toctree-l1"><a class="reference internal" href="client-install.html">WalT client software installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">WalT network structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="registries.html">WalT image registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting tips</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">User Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="shells.html">Shell usage notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using nodes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="node-ownership.html">Node ownership</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Rebooting WalT nodes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#walt-node-reboot">walt node reboot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notes-about-reboot-procedures">Notes about reboot procedures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network-boot-mode">Network boot mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hybrid-boot-mode">Hybrid boot mode</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="node-config.html">Updating configuration settings about nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-console.html">Connecting to a node’s serial console</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-cp.html">Transfering files to or from a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-save.html">Saving the current OS state of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-expose.html">Exposing the TCP port of a node</a></li>
<li class="toctree-l1"><a class="reference internal" href="node-netsetup.html">Changing network mode for a WalT node</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-networks.html">Configuring secondary networks on virtual nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vnode-disks.html">Configuring disks on virtual nodes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using images</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="image-build.html">Building a WalT image from a Dockerfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-cp.html">Transfering files to or from a walt image</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-spec-file.html">Writting image spec files</a></li>
<li class="toctree-l1"><a class="reference internal" href="image-from-scratch.html">Creating a WalT image from scratch</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="device-sets.html">Device and node sets: use several devices at once</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-config.html">Updating configuration settings about devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-port-config.html">Viewing and updating switch ports configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-expose.html">Exposing the TCP port of a device</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-netsetup.html">Changing network mode of a WalT node or device</a></li>
<li class="toctree-l1"><a class="reference internal" href="unmanaged-devices.html">Managing devices which do not implement WalT network booting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Recording logs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="logging.html">How to use WalT logging system</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-show.html">How to query &amp; display experiment logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-wait.html">Synchronizing a script based on expected logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-checkpoint.html">Log checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-history.html">Displaying past logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-realtime.html">Displaying logs in realtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-issuers.html">Selecting log issuers</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-format.html">Adapting log display format</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-echo.html"><code class="docutils literal notranslate"><span class="pre">walt-log-echo</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-cat.html"><code class="docutils literal notranslate"><span class="pre">walt-log-cat</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-tee.html"><code class="docutils literal notranslate"><span class="pre">walt-log-tee</span></code> logging tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="log-monitor.html"><code class="docutils literal notranslate"><span class="pre">walt-log-monitor</span></code> logging tool</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scripting.html">Scripting WalT experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-nodes.html">scripting API: node management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-images.html">scripting API: image management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-logs.html">scripting API: logs management</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripting-tools.html">scripting API: miscellaneous tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="web-server.html">Web server</a></li>
<li class="toctree-l1"><a class="reference internal" href="web-api.html">Using the web API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">VPN / distant nodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vpn.html">How to use WalT built-in VPN and distant nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-security.html">WalT VPN Security notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-http-entrypoint.html">How to setup a WalT VPN HTTP entrypoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="vpn-ssh-entrypoint.html">How to setup a WalT VPN SSH entrypoint</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How it works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="node-bootup.html">Node bootup procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot-modes.html">Boot modes: network boot and hybrid boot</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer documentation summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-walt-python-packages.html">Repository: walt-python-packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-client.html">Repository: walt-python-packages; walt-client code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server.html">Repository: walt-python-packages; walt-server code.</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev-server-db.html">WalT server database</a></li>
<li class="toctree-l1"><a class="reference internal" href="trackexec.html">Repository: walt-python-packages; trackexec tooling.</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design-notes.html">Scope and design notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="optional-features.html">Optional features of a WalT platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="shell-completion.html">Shell completion setup (bash and zsh)</a></li>
<li class="toctree-l1"><a class="reference internal" href="compatibility.html">Compatibility notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="new-node-support.html">Adding support for a new node in WalT</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi-serial.html">Using the serial port of a Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="g5k.html">Deploying WalT on Grid’5000</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: gray" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">WalT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Rebooting WalT nodes</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rebooting-walt-nodes">
<h1>Rebooting WalT nodes<a class="headerlink" href="#rebooting-walt-nodes" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>In its default mode of operation (1), WalT helps reproducibility by
ensuring exactly the same OS files are used at each reboot of a node.
The files are those of the WalT image, which always remains read-only
(2). Consequently, most WalT users just use a WalT image modified to
trigger an experiment script on bootup (e.g., by adding a systemd
service), and then rebooting the node(s) as many times as needed for
statistical soundness. Thus the reboot operation is very important in
WalT.</p>
<p>Notes: (1) Recently, WalT introduced another mode of operation called
hybrid-boot, which does not provide the same guarantee, but may be used
when the default network boot procedure is not suitable. Check-out
<a class="reference internal" href="boot-modes.html"><span class="doc">walt help show boot-modes</span></a> for more info. (2) One
notable exception to this fact is directory <code class="docutils literal notranslate"><span class="pre">/persist</span></code>, where one can
store data files which must be preserved across reboots.</p>
</section>
<section id="walt-node-reboot">
<h2>walt node reboot<a class="headerlink" href="#walt-node-reboot" title="Link to this heading"></a></h2>
<p>The command <code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">node</span> <span class="pre">reboot</span> <span class="pre">&lt;node&gt;</span></code> (or
<code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">node</span> <span class="pre">reboot</span> <span class="pre">&lt;node-set&gt;</span></code>) allows to reboot a node (or a set of
nodes).</p>
<p>This command first tries a “soft-reboot”, i.e., sends a REBOOT request
on TCP port 12346 of the node. If the node fails to acknowledge the
request, a “hard-reboot” is done if possible, or an error is printed.</p>
<p>Hard-rebooting a virtual node consists of killing the virtual machine
process, and is always possible. Hard-rebooting physical nodes is
possible when they are powered with Power-Over-Ethernet and config
option <code class="docutils literal notranslate"><span class="pre">poe.reboots</span></code> is enabled on the switch (cf.
<a class="reference internal" href="device-config.html"><span class="doc">walt help show device-config</span></a>). If not, an
error is printed.</p>
<p>It is possible to force a “hard-reboot”, without trying a “soft-reboot”
first, by using option <code class="docutils literal notranslate"><span class="pre">--hard</span></code>. This can be useful if ever the
“soft-reboot” is not enough (e.g., power-cycling the whole raspberry pi
board might be needed to recover proper operation of a buggy USB
device).</p>
</section>
<section id="notes-about-reboot-procedures">
<h2>Notes about reboot procedures<a class="headerlink" href="#notes-about-reboot-procedures" title="Link to this heading"></a></h2>
<p>Bootup procedures are implemented differently based on the current boot
mode of the node. Check-out
<a class="reference internal" href="boot-modes.html"><span class="doc">walt help show boot-modes</span></a> for more info about
boot modes.</p>
<section id="network-boot-mode">
<h3>Network boot mode<a class="headerlink" href="#network-boot-mode" title="Link to this heading"></a></h3>
<p>In this default mode of operation, the node stacks two filesystem
layers:</p>
<ul class="simple">
<li><p>at the bottom, the WalT image is mounted as a read-only network
filesystem;</p></li>
<li><p>at the top, a read-write layer is mounted in the RAM of the node. All
created files and file modifications will be handled by the
read-write layer, which means in the RAM of the node, and cleared up
when the node reboots (which ensures reproducibility at each reboot).
As a side effect of these RAM-only modifications,
<code class="docutils literal notranslate"><span class="pre">walt</span> <span class="pre">node</span> <span class="pre">reboot</span></code> does not bother shutting down the OS services
properly in this case, even if we call it a “soft-reboot”: it calls
the bare <code class="docutils literal notranslate"><span class="pre">busybox</span> <span class="pre">reboot</span> <span class="pre">-f</span></code> command directly, allowing for faster
reboots.</p></li>
</ul>
<p>WalT provides a way for users to alter this reboot procedure: they may
provide an executable file <code class="docutils literal notranslate"><span class="pre">/bin/walt-network-reboot</span></code>
(<code class="docutils literal notranslate"><span class="pre">/bin/walt-reboot</span></code> is accepted too for backward compatibility) in the
WALT image. In this case, this executable will be executed instead of
the bare <code class="docutils literal notranslate"><span class="pre">busybox</span> <span class="pre">reboot</span> <span class="pre">-f</span></code> command for soft-rebooting. This can be
used for implementing an optimized reboot procedure, such as using
<code class="docutils literal notranslate"><span class="pre">kexec</span></code> and avoiding long hardware reboot delays on server-class
nodes. The default images we provide for pc-x86-64 and pc-x86-32
machines are equipped with such a hook for kexec rebooting.</p>
<p>One notable exception is virtual nodes, which will never use this custom
executable for rebooting, even if present. In fact, rebooting virtual
nodes is already fast: obviously, it does not involve real hardware
intialization. Moreover, just using kexec would prevent real restarts of
the virtual machine process, whereas such restarts are needed when
changing virtual node configuration settings (e.g., adding a new disk or
network interface).</p>
<p>On physical nodes, <code class="docutils literal notranslate"><span class="pre">/bin/walt-network-reboot</span></code> may also fallback to the
bare <code class="docutils literal notranslate"><span class="pre">busybox</span> <span class="pre">reboot</span> <span class="pre">-f</span></code> command if you configured a node with
<code class="docutils literal notranslate"><span class="pre">kexec.allow=false</span></code>.</p>
</section>
<section id="hybrid-boot-mode">
<h3>Hybrid boot mode<a class="headerlink" href="#hybrid-boot-mode" title="Link to this heading"></a></h3>
<p>In this alternative mode of operation, i.e., <strong>hybrid boot mode</strong>, the
node has a copy of WalT image contents on a local disk. See
<a class="reference internal" href="boot-modes.html"><span class="doc">walt help show boot-modes</span></a> for more info. In this
mode, “soft-reboots” may take a little more time, because OS services
will be properly shut down.</p>
<p>Similarly to the network boot mode, users may provide an executable file
<code class="docutils literal notranslate"><span class="pre">/bin/walt-hybrid-reboot</span></code> to implement optimized reboot procedures in
the hybrid boot mode. The restrictions regarding virtual nodes and the
configuration option <code class="docutils literal notranslate"><span class="pre">kexec.allow=false</span></code> also apply here.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="node-ownership.html" class="btn btn-neutral float-left" title="Node ownership" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="node-config.html" class="btn btn-neutral float-right" title="Updating configuration settings about nodes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2012-2023, Members of the WALT project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>